var f=(i,c,o)=>new Promise((d,r)=>{var p=t=>{try{h(o.next(t))}catch(g){r(g)}},l=t=>{try{h(o.throw(t))}catch(g){r(g)}},h=t=>t.done?d(t.value):Promise.resolve(t.value).then(p,l);h((o=o.apply(i,c)).next())});import{r as m,c as j,e as T,f as N,j as e,u as k}from"./index-SDcol3JM.js";import{Q as _,B as w,Y as C}from"./react-toastify.esm-Dj3YYmF6.js";import{M as S}from"./index-CGE8dmKi.js";const E=({setRefreshTempletes:i})=>{const[c,o]=m.useState(!1),[d,r]=m.useState(null),[p,l]=m.useState(null),h=j(T),t=j(N),g=()=>{o(!0)},u=()=>{o(!1),r(null),l(null)},v=()=>{o(!1),r(null),l(null)},b=a=>{r(a.target.value),p&&l(null)},s=()=>f(void 0,null,function*(){if(!d)l("No value provided for templete name");else if(d.length<4)l("Enter a name with more than 4 characters");else{const a={templete_name:d,user_full_name:h,user_email:t};try{const x=yield(yield fetch("/api/method/esign_app.api.save_templete",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)})).json();console.log(x),x.message.status<300?(w.success("Templete Created Successfully",{position:"top-right",autoClose:500,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"dark",transition:C}),r(null),o(!1),i(y=>!y)):w.error("Error while saving templete",{position:"top-right",autoClose:500,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"dark",transition:C})}catch(n){console.error("Error:",n),alert("An error occurred while saving the templete")}}});return e.jsxs(e.Fragment,{children:[e.jsx("div",{children:e.jsx("button",{className:"bg-[#283C42] text-white px-4 py-2 rounded border-2 border-transparent hover:border-[#283C42] hover:bg-white hover:text-[#283C42] transition-colors duration-300",onClick:g,children:"Add Templete"})}),e.jsx(S,{title:"Add Templete",open:c,onCancel:u,footer:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:s,className:"bg-[#283C42] text-white px-4 py-2 rounded border-2 border-transparent hover:border-[#283C42] hover:bg-white hover:text-[#283C42] transition-colors duration-300",children:"Save"},"save-button"),e.jsx("button",{className:"bg-[#283C42] text-white px-4 py-2 rounded border-2 border-transparent hover:border-[#ca2424] hover:bg-white hover:text-[#ca2424] transition-colors duration-300",onClick:v,children:"Cancel"},"cancel-button")]},"footer-buttons")],children:e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{className:"block text-gray-700 text-sm font-bold mb-2",children:"Templete Name"}),e.jsx("input",{className:"bg-[#d1e0e4] text-gray-700 focus:outline-none focus:shadow-outline border border-gray-300 rounded py-2 px-4 block w-full appearance-none",type:"text",value:d||"",onChange:b}),p&&e.jsx("p",{className:"text-red-500 text-sm mt-2",children:p})]})}),e.jsx(_,{limit:1})]})},M=({refreshTempletes:i,setRefreshTempletes:c})=>{const o=k(),d=s=>{o(`/templete/${s.name}`,{state:{templete:s}})},r=j(N),[p,l]=m.useState([]),[h,t]=m.useState(!0),[g,u]=m.useState(null);m.useEffect(()=>{(r||i)&&f(void 0,null,function*(){try{const a=yield fetch(`/api/method/esign_app.api.get_templetes?user_mail=${r}`,{method:"GET",headers:{"Content-Type":"application/json"}}),n=yield a.json();a.status===200?n.message.data.length>0?(l(n.message.data),t(!1)):(u("No templates found"),t(!1)):(u("Failed to fetch templates"),t(!1))}catch(a){u("An error occurred while fetching templates"),t(!1)}})},[r,i]);const v=s=>f(void 0,null,function*(){try{const n=yield(yield fetch(`/api/method/esign_app.api.delete_esign_templete?user_mail=${r}&name=${s}`,{method:"POST",headers:{"Content-Type":"application/json"}})).json();console.log("Delete Template API Response:",n),n.message.status===200?(l(p.filter(x=>x.name!==s)),c(!0),b()):(console.error("Failed to delete template:",n.message),u("Failed to delete template"))}catch(a){console.error("Error deleting template:",a),u("Error deleting template")}});if(h)return e.jsx("div",{children:"Loading..."});function b(){w.error("Templete Deleted successfully",{position:"top-right",autoClose:500,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"dark",transition:C})}return e.jsx("div",{className:"relative mt-6 min-w-[1000px] max-w-[1000px] mx-auto",children:e.jsx("div",{className:"flex flex-wrap gap-5",children:p.map((s,a)=>e.jsxs("div",{className:"relative flex w-[200px]",children:[e.jsx("div",{className:"absolute top-2 right-2 cursor-pointer",onClick:()=>v(s.name),children:e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"feather feather-trash-2 text-red-600",children:[e.jsx("polyline",{points:"3 6 5 6 21 6"}),e.jsx("path",{d:"M19 6l-2 14H7L5 6"}),e.jsx("path",{d:"M10 11v6"}),e.jsx("path",{d:"M14 11v6"}),e.jsx("path",{d:"M18 4l-1-1h-8L7 4"})]})}),e.jsxs("div",{className:"bg-[#283C42] text-white rounded border-2 border-transparent hover:border-[#283C42] hover:bg-white hover:text-[#283C42] transition-colors duration-300 cursor-pointer p-4",style:{width:"350px",height:"100px"},onClick:()=>d(s),children:[e.jsx("h3",{className:"mt-2 font-bold",children:s.templete_title}),e.jsx("p",{className:"text-sm text-gray-500",children:new Date(s.templete_created_at).toLocaleString()})]})]},a))})})};function P(){const[i,c]=m.useState(!1);return e.jsxs(e.Fragment,{children:[e.jsx(E,{setRefreshTempletes:c}),e.jsx(M,{refreshTempletes:i,setRefreshTempletes:c})]})}export{P as default};

var v=(u,d,n)=>new Promise((r,p)=>{var h=a=>{try{i(n.next(a))}catch(o){p(o)}},m=a=>{try{i(n.throw(a))}catch(o){p(o)}},i=a=>a.done?r(a.value):Promise.resolve(a.value).then(h,m);i((n=n.apply(u,d)).next())});import{r as l,e as T,i as M,f as S,u as _,j as e}from"./index-BILL9kc1.js";import{Q as L,B as k,Y as E}from"./react-toastify.esm-xgz3Dsox.js";import{a4 as O}from"./index-DdTaY_S1.js";import{C as A}from"./ConfirmDeleteModal-B747tzlS.js";const D=({setRefreshTempletes:u})=>{const[d,n]=l.useState(!1),[r,p]=l.useState(null),[h,m]=l.useState(null),[i,a]=l.useState(!1),o=T(M),b=T(S),g=_(),f=()=>{n(!0)},w=()=>{n(!1),p(null),m(null)},j=()=>{n(!1),p(null),m(null)},y=t=>{const c=t.target.value.replace(/\s{2,}/g," ");p(c),h&&m(null)},C=t=>{const s=Array.isArray(t)?t[0]:t;console.log("Here is the navigate function",s.name),g(`/templete/${s.name}`,{state:{templete:s}})},x=()=>v(void 0,null,function*(){if(a(!0),!r)m("No value provided for templete name");else if(r.length<4)m("Enter a name with more than 4 characters");else{const t={templete_name:r,user_full_name:o,user_email:b};try{const c=yield(yield fetch("/api/method/esign_app.api.save_templete",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})).json();console.log(c),c.message.status<300?(k.success("Templete Created Successfully",{position:"top-right",autoClose:500,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"dark",transition:E}),p(null),n(!1),u(N=>!N),a(!1),C(c.message.data)):(k.error("Error while saving templete",{position:"top-right",autoClose:500,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"dark",transition:E}),a(!0))}catch(s){console.error("Error:",s),alert("An error occurred while saving the templete")}}});return l.useEffect(()=>{if(d){const t=s=>{s.key==="Enter"&&i==!1&&(a(!0),x().then(()=>a(!1)))};return window.addEventListener("keydown",t),()=>{window.removeEventListener("keydown",t)}}},[d,o,r]),e.jsxs(e.Fragment,{children:[e.jsx("div",{children:e.jsx("button",{className:"bg-[#283C42] text-white px-4 py-2 rounded border-2 border-transparent hover:border-[#283C42] hover:bg-white hover:text-[#283C42] transition-colors duration-300",onClick:f,children:"Add Templete"})}),e.jsx(O,{title:"Add Templete",open:d,onCancel:w,footer:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{disabled:i,onClick:x,className:"bg-[#283C42] text-white px-4 py-2 rounded border-2 border-transparent hover:border-[#283C42] hover:bg-white hover:text-[#283C42] transition-colors duration-300",children:"Save"},"save-button"),e.jsx("button",{className:"bg-[#283C42] text-white px-4 py-2 rounded border-2 border-transparent hover:border-[#ca2424] hover:bg-white hover:text-[#ca2424] transition-colors duration-300",onClick:j,children:"Cancel"},"cancel-button")]},"footer-buttons")],children:e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{className:"block text-gray-700 text-sm font-bold mb-2",children:"Templete Name"}),e.jsx("input",{className:"bg-[#d1e0e4] text-gray-700 focus:outline-none focus:shadow-outline border border-gray-300 rounded py-2 px-4 block w-full appearance-none",type:"text",value:r||"",onChange:y}),h&&e.jsx("p",{className:"text-red-500 text-sm mt-2",children:h})]})}),e.jsx(L,{limit:1})]})},V=({refreshTempletes:u,setRefreshTempletes:d})=>{const n=_(),r=T(S),[p,h]=l.useState([]),[m,i]=l.useState(!0),[a,o]=l.useState(null),[b,g]=l.useState(!1),[f,w]=l.useState(null);l.useEffect(()=>{(r||u)&&v(void 0,null,function*(){try{const s=yield fetch(`/api/method/esign_app.api.get_templetes?user_mail=${r}`,{method:"GET",headers:{"Content-Type":"application/json"}}),c=yield s.json();s.status===200?c.message.data.length>0?(h(c.message.data),i(!1)):(o("No templates found"),i(!1)):(o("Failed to fetch templates"),i(!1))}catch(s){o("An error occurred while fetching templates"),i(!1)}})},[r,u]);const j=t=>{n(`/templete/${t.name}`,{state:{templete:t}})},y=t=>v(void 0,null,function*(){if(f)try{const c=yield(yield fetch(`/api/method/esign_app.api.delete_esign_templete?user_mail=${r}&name=${t}`,{method:"POST",headers:{"Content-Type":"application/json"}})).json();c.message.status===200?(h(p.filter(N=>N.name!==t)),d(!0),x()):(console.error("Failed to delete template:",c.message),o("Failed to delete template"))}catch(s){console.error("Error deleting template:",s),o("Error deleting template")}finally{g(!1)}}),C=t=>{w(t),g(!0)};function x(){k.error("Template Deleted successfully",{position:"top-right",autoClose:500,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"dark",transition:E})}return m?e.jsx("div",{children:"Loading..."}):e.jsxs("div",{className:"relative mt-6 min-w-[1000px] max-w-[1000px] mx-auto",children:[e.jsx("div",{className:"flex flex-wrap gap-5",children:p.map((t,s)=>e.jsxs("div",{className:"relative flex w-[200px] h-[100px]",children:[e.jsx("div",{className:"absolute top-2 right-2 cursor-pointer",onClick:()=>C(t),children:e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"feather feather-trash-2 text-red-600",children:[e.jsx("polyline",{points:"3 6 5 6 21 6"}),e.jsx("path",{d:"M19 6l-2 14H7L5 6"}),e.jsx("path",{d:"M10 11v6"}),e.jsx("path",{d:"M14 11v6"}),e.jsx("path",{d:"M18 4l-1-1h-8L7 4"})]})}),e.jsxs("div",{className:"bg-[#283C42] text-white rounded border-2 border-transparent hover:border-[#283C42] hover:bg-white hover:text-[#283C42] transition-colors duration-300 cursor-pointer p-4",style:{width:"200px",height:"100px"},onClick:()=>j(t),children:[e.jsx("h3",{className:"mt-2 font-bold text-ellipsis overflow-hidden whitespace-nowrap",children:t.templete_title}),e.jsx("p",{className:"text-sm text-gray-500 text-ellipsis overflow-hidden whitespace-nowrap",children:new Date(t.templete_created_at).toLocaleString()})]})]},s))}),f&&e.jsx(A,{visible:b,name:f.name,message:`Are you sure you want to delete the template "${f.templete_title}"?`,module:"Template",onCancel:()=>g(!1),onConfirm:y})]})};function R(){const[u,d]=l.useState(!1);return e.jsxs(e.Fragment,{children:[e.jsx(D,{setRefreshTempletes:d}),e.jsx(V,{refreshTempletes:u,setRefreshTempletes:d})]})}export{R as default};

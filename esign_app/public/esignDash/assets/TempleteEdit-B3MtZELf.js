var _e=Object.defineProperty,Te=Object.defineProperties;var Re=Object.getOwnPropertyDescriptors;var X=Object.getOwnPropertySymbols;var Me=Object.prototype.hasOwnProperty,Be=Object.prototype.propertyIsEnumerable;var Z=(l,r,s)=>r in l?_e(l,r,{enumerable:!0,configurable:!0,writable:!0,value:s}):l[r]=s,N=(l,r)=>{for(var s in r||(r={}))Me.call(r,s)&&Z(l,s,r[s]);if(X)for(var s of X(r))Be.call(r,s)&&Z(l,s,r[s]);return l},k=(l,r)=>Te(l,Re(r));var z=(l,r,s)=>new Promise((u,_)=>{var v=m=>{try{f(s.next(m))}catch(D){_(D)}},S=m=>{try{f(s.throw(m))}catch(D){_(D)}},f=m=>m.done?u(m.value):Promise.resolve(m.value).then(v,S);f((s=s.apply(l,r)).next())});import{r as x,j as t,h as Ee,u as Oe,M as We}from"./index-SDcol3JM.js";import{Q as Ie,B as ee,Y as te}from"./react-toastify.esm-Dj3YYmF6.js";import{p as Ue,d as Ae,H as $e,D as Fe,i as Le,B as Je,a as Ve,s as qe,P as oe,r as Qe}from"./PDFtoBase64-aQnwWDhC.js";const Ye=({pdfData:l})=>{const r=x.useRef(null);return x.useEffect(()=>{z(void 0,null,function*(){const u=r.current;if(u){const v=yield(yield Ue.getDocument({data:atob(l)}).promise).getPage(1),S=v.getViewport({scale:1}),f=u.getContext("2d");if(f){f.clearRect(0,0,u.width,u.height),u.width=S.width,u.height=S.height;const m={canvasContext:f,viewport:S};yield v.render(m).promise}}else console.error("Canvas not found.")})},[l]),t.jsx("canvas",{ref:r,width:297,height:420})},et=()=>{var F,L,J,V;const[l,r]=x.useState([]),[s,u]=x.useState(null),[_,v]=x.useState(null),[S,f]=x.useState(""),[m,D]=x.useState(""),[w,R]=x.useState(0),[H,O]=x.useState(Ae),ae=x.useRef(null),j=x.useRef(null),se=x.useRef(null),ne=Ee(),{templete:C}=ne.state||{},re=Oe();x.useEffect(()=>{z(void 0,null,function*(){try{const a=yield(yield fetch(`/api/method/esign_app.api.get_template_json?templete_name=${C?C.name:""}`)).json();if(console.log(a),a.message.templete_json_data==null||a.message.base_pdf_data==null)return;if(a.message.status===200){const n=typeof a.message.templete_json_data=="string"?JSON.parse(a.message.templete_json_data):a.message.templete_json_data,i=typeof a.message.base_pdf_data=="string"?JSON.parse(a.message.base_pdf_data):a.message.base_pdf_data;r(n),O(i)}}catch(o){console.error("Error:",o)}})},[]);const ie={name:"editable",props:[],events:[],render(e,o){const a=e.getRect(),{pos2:n}=e.state,i=e.useCSS("div",`
        {
            position: absolute;
            left: 0px;
            top: 0px;
            will-change: transform;
            transform-origin: 0px 0px;
        }
        .custom-button {
            width: 24px;
            height: 24px;
            margin-bottom: 4px;
            background: #283C42;
            border-radius: 4px;
            appearance: none;
            border: 0;
            color: white;
            font-weight: bold;
        }
            `);return t.jsxs(i,{className:"moveable-editable",style:{transform:`translate(${n[0]}px, ${n[1]}px) rotate(${a.rotation}deg) translate(10px)`},children:[t.jsx("button",{className:"w-6 h-6 mb-1 p-1 bg-[#283C42] rounded border-none text-white font-bold",onClick:A,children:t.jsx("svg",{viewBox:"0 0 1024 1024",fill:"currentColor",height:"1em",width:"1em",children:t.jsx("path",{d:"M360 184h-8c4.4 0 8-3.6 8-8v8h304v-8c0 4.4 3.6 8 8 8h-8v72h72v-80c0-35.3-28.7-64-64-64H352c-35.3 0-64 28.7-64 64v80h72v-72zm504 72H160c-17.7 0-32 14.3-32 32v32c0 4.4 3.6 8 8 8h60.4l24.7 523c1.6 34.1 29.8 61 63.9 61h454c34.2 0 62.3-26.8 63.9-61l24.7-523H888c4.4 0 8-3.6 8-8v-32c0-17.7-14.3-32-32-32zM731.3 840H292.7l-24.2-512h487l-24.2 512z"})})}),t.jsx("button",{className:"w-6 h-6 mb-1 p-1 bg-[#283C42] rounded border-none text-white font-bold",onClick:()=>{s!==null?Ce(s):f("")},children:t.jsxs("svg",{viewBox:"0 0 1024 1024",fill:"currentColor",height:"1em",width:"1em",children:[t.jsx("defs",{children:t.jsx("style",{})}),t.jsx("path",{d:"M899.1 869.6l-53-305.6H864c14.4 0 26-11.6 26-26V346c0-14.4-11.6-26-26-26H618V138c0-14.4-11.6-26-26-26H432c-14.4 0-26 11.6-26 26v182H160c-14.4 0-26 11.6-26 26v192c0 14.4 11.6 26 26 26h17.9l-53 305.6c-.3 1.5-.4 3-.4 4.4 0 14.4 11.6 26 26 26h723c1.5 0 3-.1 4.4-.4 14.2-2.4 23.7-15.9 21.2-30zM204 390h272V182h72v208h272v104H204V390zm468 440V674c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8v156H416V674c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8v156H202.8l45.1-260H776l45.1 260H672z"})]})})]},"editable-viewer")}},le=()=>{w<H.length-1&&(R(w+1),v(null),u(null))},de=()=>{w>0&&(R(w-1),v(null),u(null))},ce=e=>{D(e.target.value)},he=()=>{s!==null&&m.trim()!==""&&(r(e=>e.map(o=>o.id===s?k(N({},o),{assign:[...o.assign||[],m]}):o)),D(""))},pe=e=>{s!==null&&r(o=>o.map(a=>a.id===s?k(N({},a),{assign:(a.assign||[]).filter(n=>n!==e)}):a))},W=e=>{const o={id:Date.now(),type:e,pageNo:w,name:`${e}-${Date.now()}`,position:{top:50,left:50},size:{width:100,height:100},fontSize:16,value:"",assign:[],content:e==="text"?"":void 0};r([...l,o])},ge=(e,o,a)=>{r(n=>n.map(i=>i.id===e?k(N({},i),{position:{top:o,left:a}}):i))},I=(e,o,a)=>{r(n=>n.map(i=>i.id===e?k(N({},i),{size:{width:o,height:a}}):i))},ue=e=>{const o=e.target.value;f(o),s!==null&&r(a=>a.map(n=>n.id===s?k(N({},n),{content:o,value:o}):n))},xe=e=>{e.target.closest(".component")||(u(null),v(null))},U=e=>{s!==null&&r(o=>o.map(a=>a.id===s?k(N({},a),{fontSize:(a.fontSize||16)+(e?2:-2)}):a))},A=()=>{s!==null&&(r(e=>e.filter(o=>o.id!==s)),u(null),v(null))},me=()=>{const e=l.map(({id:o,type:a,content:n,pageNo:i,value:h,position:p,size:d,name:y,fontSize:c,assign:b})=>({id:o,type:a,content:n,pageNo:i,value:h,position:p,size:d,name:y,fontSize:c,assign:b}));console.log(JSON.stringify(e,null,2))},be=e=>{switch(e.target.value){case"loadComponents":r(Le);break;case"loadDexcissComponents":r(Fe);break;case"loadHelloDexcissComponents":r($e);break;case"loadBlank":r([]);break;default:r([])}},fe=()=>z(void 0,null,function*(){try{R(0),r([]),O(Je)}catch(e){console.error("Error loading data:",e)}}),ve=e=>z(void 0,null,function*(){var a;const o=(a=e.target.files)==null?void 0:a[0];if(o){const n=yield Ve(o),i=yield qe(n);O(i),R(0)}});x.useEffect(()=>{if(s!==null){const e=document.querySelector(`[data-id="${s}"]`);v(e);const o=l.find(a=>a.id===s);(o==null?void 0:o.type)==="text"&&f(o.content||"")}},[s,l]);const $=e=>Uint8Array.from(atob(e),o=>o.charCodeAt(0)),we=()=>z(void 0,null,function*(){var y;const e=yield oe.create();for(let c=0;c<H.length;c++){const b=$(H[c].data),P=yield oe.load(b);(yield e.copyPages(P,P.getPageIndices())).forEach(M=>e.addPage(M))}const o=l.reduce((c,b)=>(c[b.pageNo]||(c[b.pageNo]=[]),c[b.pageNo].push(b),c),{}),a=e.getPages();for(const c of a){const b=a.indexOf(c),P=o[b]||[];for(const g of P){const{left:M,top:q}=g.position;if(g.type==="text"){const T=(y=g.fontSize)!=null?y:12,B=c.getHeight()-q-T-3;c.drawText(g.content||"",{x:M+3,y:B,size:g.fontSize,color:Qe(0,0,0),lineHeight:T*1.2,maxWidth:g.size.width})}else if(g.type==="image"&&g.content){const T=g.content.split(",")[1];if(!T){console.error("Invalid image data");continue}const B=$(T);let E;if(g.content.startsWith("data:image/png"))E=yield e.embedPng(B);else if(g.content.startsWith("data:image/jpeg")||g.content.startsWith("data:image/jpg"))E=yield e.embedJpg(B);else{console.error("Unsupported image format");continue}const{width:Q,height:Y}=E,Ne=g.size.width,ke=g.size.height,Se=Ne/Q,He=ke/Y,G=Math.min(Se,He),ze=Q*G,K=Y*G,De=M,Pe=c.getHeight()-q-K;c.drawImage(E,{x:De,y:Pe,width:ze,height:K})}}}const n=yield e.save(),i=new Blob([n],{type:"application/pdf"}),h=URL.createObjectURL(i),p=`esignTemplate-${C?C.templete_title:"eSignTemplate"}`,d=document.createElement("a");d.href=h,d.download=`${p}.pdf`,document.body.appendChild(d),d.click(),document.body.removeChild(d),URL.revokeObjectURL(h)}),Ce=e=>{r(o=>o.map(a=>a.id===e?k(N({},a),{content:void 0,value:void 0}):a))},je=(e,o)=>{var n;const a=(n=e.target.files)==null?void 0:n[0];if(a){const i=new FileReader;i.onloadend=()=>{const h=i.result;r(p=>p.map(d=>d.id===o?k(N({},d),{content:h}):d))},i.readAsDataURL(a)}},ye=()=>z(void 0,null,function*(){if(!C||!C.name)return;const e=l.map(({id:a,type:n,content:i,pageNo:h,value:p,position:d,size:y,name:c,fontSize:b,assign:P})=>({id:a,type:n,pageNo:h,assign:P,size:y,name:c,fontSize:b,position:d,content:i,value:p}));console.log(JSON.stringify(e,null,2));const o={templete_name:C.name,templete_json_data:JSON.stringify(JSON.stringify(e,null,2)),base_pdf_data:JSON.stringify(JSON.stringify(H,null,2))};try{const n=yield(yield fetch("/api/method/esign_app.api.update_template",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)})).json();console.log(n),n.message.status<300?ee.success("Template Updated Successfully",{position:"top-right",autoClose:500,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"dark",transition:te}):ee.error("Error while updating template",{position:"top-right",autoClose:500,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"dark",transition:te})}catch(a){console.error("Error:",a),alert("An error occurred while updating the template")}});return C?t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"text-xs flex gap-3 relative p-6 bg-[#283C42] text-white border-2 border-transparent hover:border-[#283C42] transition-colors duration-300",children:[t.jsx("button",{className:"absolute top-4 right-2 bg-[#551116] text-white px-5 py-1 rounded border-2 border-transparent hover:border-[#551116] hover:bg-white hover:text-[#551116] transition-colors duration-300",onClick:()=>re(-1),children:"Back"}),t.jsx("h1",{className:"font-bold",children:C.templete_title}),t.jsxs("p",{children:["Created At: ",new Date(C.templete_created_at).toLocaleString()]})]}),t.jsxs("div",{className:"templete-main-div",children:[t.jsxs("div",{className:"control-buttons gap-2 text-xs",children:[t.jsx("input",{type:"file",accept:"application/pdf",onChange:ve,className:"bg-gray-100 text-[#283C42] border-1 border-[#283C42] px-4 py-2 rounded hover:bg-[#283C42] hover:text-white hover:border-white transition-colors duration-300"}),t.jsxs("select",{className:"bg-[#283C42] text-white px-4 py-2 rounded border-2 border-transparent hover:border-[#283C42] hover:bg-white hover:text-[#283C42] transition-colors duration-300",onChange:be,children:[t.jsx("option",{value:"",disabled:!0,selected:!0,children:"Select Template"}),t.jsx("option",{value:"loadBlank",children:"Blank"}),t.jsx("option",{value:"loadComponents",children:"Load Template 1"}),t.jsx("option",{value:"loadDexcissComponents",children:"Load Dexciss Components"}),t.jsx("option",{value:"loadHelloDexcissComponents",children:"Load Hello Dexciss Components"})]}),t.jsx("button",{className:"bg-[#283C42] text-white px-4 py-2 rounded border-2 border-transparent hover:border-[#283C42] hover:bg-white hover:text-[#283C42] transition-colors duration-300",onClick:fe,children:"Load Blank Page"}),t.jsx("button",{className:"bg-[#283C42] text-white px-4 py-2 rounded border-2 border-transparent hover:border-[#283C42] hover:bg-white hover:text-[#283C42] transition-colors duration-300",onClick:()=>W("text"),children:"Add Text"}),t.jsx("button",{className:"bg-[#283C42] text-white px-4 py-2 rounded border-2 border-transparent hover:border-[#283C42] hover:bg-white hover:text-[#283C42] transition-colors duration-300",onClick:()=>W("image"),children:"Add Image"}),t.jsx("button",{className:"bg-[#283C42] text-white px-4 py-2 rounded border-2 border-transparent hover:border-[#283C42] hover:bg-white hover:text-[#283C42] transition-colors duration-300",onClick:me,children:"Log Component Data"}),t.jsx("button",{className:"bg-[#283C42] text-white px-4 py-2 rounded border-2 border-transparent hover:border-[#283C42] hover:bg-white hover:text-[#283C42] transition-colors duration-300",onClick:we,children:"Merge and Print PDF"}),t.jsx("button",{className:"bg-[#283C42] text-white px-4 py-2 rounded border-2 border-transparent hover:border-[#283C42] hover:bg-white hover:text-[#283C42] transition-colors duration-300",onClick:ye,children:"Save Templete"})]}),t.jsxs("div",{className:"templete-app text-xs",children:[t.jsxs("div",{className:"flex gap-3 mb-2",children:[t.jsx("button",{className:"bg-[#283C42] text-white px-4 py-2 rounded border-2 border-transparent hover:border-[#283C42] hover:bg-white hover:text-[#283C42] transition-colors duration-300",onClick:de,disabled:w===0,children:"Previous"}),t.jsxs("h1",{className:"mt-2",children:[w+1," / ",H.length]}),t.jsx("button",{className:"bg-[#283C42] text-white px-4 py-2 rounded border-2 border-transparent hover:border-[#283C42] hover:bg-white hover:text-[#283C42] transition-colors duration-300",onClick:le,disabled:w===H.length-1,children:"Next"})]}),t.jsxs("div",{className:"workspace",ref:j,onClick:xe,children:[t.jsx(Ye,{pdfData:H[w].data}),l.filter(e=>e.pageNo===w).map(e=>t.jsx("div",{"data-id":e.id,className:`component ${e.type} ${s===e.id?"selected":""}`,style:{position:"absolute",top:e.position.top,left:e.position.left,width:e.size.width,height:e.size.height,border:s===e.id?"1px solid red":"none",fontSize:`${e.fontSize}px`,userSelect:"none",overflow:"hidden"},onClick:o=>{o.stopPropagation(),u(e.id)},children:e.type==="text"?t.jsx("div",{style:{width:"100%",height:"100%",overflow:"hidden",fontSize:"inherit",outline:"none"},children:e.content||"Editable Text"}):t.jsxs("div",{style:{position:"relative",width:"100%",height:"100%"},children:[!e.content&&t.jsx("input",{type:"file",accept:"image/*",onChange:o=>je(o,e.id)}),e.content&&t.jsx("div",{children:t.jsx("img",{src:e.content,alt:"Uploaded",style:{width:"100%",height:"100%"}})})]})},e.id)),t.jsx(We,{ref:ae,target:_,resizable:!0,draggable:!0,ables:[ie],props:{editable:!0},bounds:{left:0,top:0,right:((F=j.current)==null?void 0:F.offsetWidth)||0,bottom:((L=j.current)==null?void 0:L.offsetHeight)||0},onDrag:e=>{var d,y;const o=((d=j.current)==null?void 0:d.offsetWidth)||0,a=((y=j.current)==null?void 0:y.offsetHeight)||0,n=e.target.clientWidth||0,i=e.target.clientHeight||0,h=Math.max(0,Math.min(e.top,a-i)),p=Math.max(0,Math.min(e.left,o-n));s!==null&&ge(s,h,p)},onResize:e=>{var h,p;const o=((h=j.current)==null?void 0:h.offsetWidth)||0,a=((p=j.current)==null?void 0:p.offsetHeight)||0,n=Math.max(0,Math.min(e.width,o)),i=Math.max(0,Math.min(e.height,a));e.target.style.width=`${n}px`,e.target.style.height=`${i}px`,s!==null&&I(s,n,i)},onScale:e=>{var i,h;const o=((i=j.current)==null?void 0:i.offsetWidth)||0,a=((h=j.current)==null?void 0:h.offsetHeight)||0,n=l.find(p=>p.id===s);if(n){const p=Math.max(0,Math.min(n.size.width*e.scale[0],o)),d=Math.max(0,Math.min(n.size.height*e.scale[1],a));I(s,p,d)}}})]})]}),t.jsxs("div",{className:"right-templete",children:[t.jsx("div",{className:"templete-utility-btn mt-2 text-xs pr-20",children:s&&t.jsxs(t.Fragment,{children:[t.jsx("button",{className:"bg-[#283C42] text-white px-4 py-2 rounded border-2 border-transparent hover:border-[#283C42] hover:bg-white hover:text-[#283C42] transition-colors duration-300",onClick:()=>U(!0),children:"Increase Text Size"}),t.jsx("button",{className:"bg-[#283C42] text-white px-4 py-2 rounded border-2 border-transparent hover:border-[#283C42] hover:bg-white hover:text-[#283C42] transition-colors duration-300",onClick:()=>U(!1),children:"Decrease Text Size"}),t.jsx("button",{className:"bg-[#283C42] text-white px-4 py-2 rounded border-2 border-transparent hover:border-[#283C42] hover:bg-white hover:text-[#283C42] transition-colors duration-300",onClick:A,children:"Delete Component"}),t.jsx("input",{className:"bg-[#d1e0e4] text-gray-700 focus:outline-none focus:shadow-outline border border-gray-300 rounded py-2 px-4 block w-full appearance-none",ref:se,type:"text",value:S,onChange:ue,placeholder:"Edit text here"})]})}),s&&t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"templete-utility-btn-add-user flex m-3 gap-3 text-xs pr-10 ml-0",children:[t.jsx("input",{className:"bg-[#d1e0e4] text-gray-700 focus:outline-none focus:shadow-outline border border-gray-300 rounded py-2 px-4 block w-full appearance-none",type:"text",value:m,onChange:ce,placeholder:"Add user"}),t.jsx("button",{className:" bg-[#283C42] text-white px-4 py-2 rounded border-2 border-transparent hover:border-[#283C42] hover:bg-white hover:text-[#283C42] transition-colors duration-300",onClick:he,children:"Add"})]}),t.jsx("div",{children:t.jsx("ul",{className:"list-none p-0 m-0 pr-10",children:(V=(J=l.find(e=>e.id===s))==null?void 0:J.assign)==null?void 0:V.map((e,o)=>t.jsxs("li",{className:"mr-3 flex items-center justify-between p-2 border-b border-gray-200 hover:bg-gray-100",children:[t.jsx("span",{className:"text-xs text-gray-800 overflow-hidden ",children:e}),t.jsx("button",{onClick:()=>pe(e),className:"flex items-center justify-center w-8 h-8 bg-red-500 text-white rounded-full hover:bg-red-600","aria-label":"Remove user",children:t.jsx("svg",{viewBox:"0 0 1024 1024",fill:"currentColor",height:"1em",width:"1em",children:t.jsx("path",{d:"M678.3 655.4c24.2-13 51.9-20.4 81.4-20.4h.1c3 0 4.4-3.6 2.2-5.6a371.67 371.67 0 00-103.7-65.8c-.4-.2-.8-.3-1.2-.5C719.2 518 759.6 444.7 759.6 362c0-137-110.8-248-247.5-248S264.7 225 264.7 362c0 82.7 40.4 156 102.6 201.1-.4.2-.8.3-1.2.5-44.7 18.9-84.8 46-119.3 80.6a373.42 373.42 0 00-80.4 119.5A373.6 373.6 0 00137 901.8a8 8 0 008 8.2h59.9c4.3 0 7.9-3.5 8-7.8 2-77.2 32.9-149.5 87.6-204.3C357 641.2 432.2 610 512.2 610c56.7 0 111.1 15.7 158 45.1a8.1 8.1 0 008.1.3zM512.2 534c-45.8 0-88.9-17.9-121.4-50.4A171.2 171.2 0 01340.5 362c0-45.9 17.9-89.1 50.3-121.6S466.3 190 512.2 190s88.9 17.9 121.4 50.4A171.2 171.2 0 01683.9 362c0 45.9-17.9 89.1-50.3 121.6C601.1 516.1 558 534 512.2 534zM880 772H640c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h240c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8z"})})})]},o))})})]})]})]}),t.jsx(Ie,{limit:1})]}):t.jsx("div",{children:"No template data available"})};export{et as default};

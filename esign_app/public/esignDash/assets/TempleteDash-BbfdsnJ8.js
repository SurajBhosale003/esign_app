var S=(u,i,c)=>new Promise((o,n)=>{var m=a=>{try{d(c.next(a))}catch(f){n(f)}},x=a=>{try{d(c.throw(a))}catch(f){n(f)}},d=a=>a.done?o(a.value):Promise.resolve(a.value).then(m,x);d((c=c.apply(u,i)).next())});import{r as s,c as k,i as R,e as A,u as L,j as e}from"./index-0nKeV5mV.js";import{Q as I,B as E,Y as M}from"./react-toastify.esm-Dgz2zfA7.js";import{M as G}from"./index-gDlXHgX-.js";import{C as J}from"./ConfirmDeleteModal-dRA6CzTo.js";import"./PurePanel-BDIKaUYK.js";const K=({setRefreshTempletes:u})=>{const[i,c]=s.useState(!1),[o,n]=s.useState(null),[m,x]=s.useState(null),[d,a]=s.useState(!1),f=k(R),_=k(A),C=L(),j=()=>{c(!0)},y=()=>{c(!1),n(null),x(null)},w=r=>{const h=r.target.value.replace(/\s{2,}/g," ");n(h),m&&x(null)},T=r=>{const l=Array.isArray(r)?r[0]:r;console.log("Here is the navigate function",l.name),C(`/templete/${l.name}`,{state:{templete:l}})},g=()=>S(void 0,null,function*(){if(a(!0),!o)x("No value provided for templete name");else if(o.length<4)x("Enter a name with more than 4 characters");else{const r={templete_name:o,user_full_name:f,user_email:_};try{const h=yield(yield fetch("/api/method/esign_app.api.save_templete",{method:"POST",headers:{"Content-Type":"application/json","X-Frappe-CSRF-Token":window.csrf_token},body:JSON.stringify(r)})).json();console.log(h),h.message.status<300?(E.success("Templete Created Successfully",{position:"top-right",autoClose:500,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"dark",transition:M}),n(null),c(!1),u(v=>!v),a(!1),T(h.message.data)):(E.error("Error while saving templete",{position:"top-right",autoClose:500,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"dark",transition:M}),a(!0))}catch(l){console.error("Error:",l),alert("An error occurred while saving the templete")}}});return s.useEffect(()=>{if(i){const r=l=>{l.key==="Enter"&&d==!1&&(a(!0),g().then(()=>a(!1)))};return window.addEventListener("keydown",r),()=>{window.removeEventListener("keydown",r)}}},[i,f,o]),e.jsxs(e.Fragment,{children:[e.jsx("div",{children:e.jsx("button",{className:"bg-[#283C42] text-white px-4 py-2 rounded border-2 border-transparent hover:border-[#283C42] hover:bg-white hover:text-[#283C42] transition-colors duration-300",onClick:j,children:"Add Templete"})}),e.jsx(G,{title:"Add Template",open:i,onCancel:y,rootClassName:"glass-modal",footer:[e.jsxs("div",{className:"flex justify-end gap-2 px-4 pb-4",children:[e.jsx("button",{disabled:d,onClick:g,className:"bg-[#283C42] text-white px-4 py-2 rounded border-2 border-transparent hover:border-[#283C42] hover:bg-white hover:text-[#283C42] transition-colors duration-300",children:"Save"}),e.jsx("button",{className:"bg-[#283C42] text-white px-4 py-2 rounded border-2 border-transparent hover:border-[#ca2424] hover:bg-white hover:text-[#ca2424] transition-colors duration-300",onClick:y,children:"Cancel"})]},"footer-buttons")],children:e.jsxs("div",{className:"px-2 pb-4",children:[e.jsx("input",{className:"w-full mt-5 bg-white/20 text-white placeholder:text-white/60 backdrop-blur-md border border-white/30 rounded py-2 px-3 text-sm focus:outline-none focus:ring-2 focus:ring-white/50 transition-all duration-300",type:"text",value:o||"",onChange:w,placeholder:"Enter template name"}),m&&e.jsx("p",{className:"text-red-400 text-sm mt-2",children:m})]})}),e.jsx(I,{limit:1})]})},Q=({refreshTempletes:u,setRefreshTempletes:i})=>{const c=L(),o=k(A),[n,m]=s.useState([]),[x,d]=s.useState([]),[a,f]=s.useState(!0),[_,C]=s.useState(null),[j,y]=s.useState(""),[w,T]=s.useState(""),[g,r]=s.useState(""),[l,h]=s.useState(!1),[v,F]=s.useState(null);s.useEffect(()=>{(o||u)&&S(void 0,null,function*(){try{const p=yield fetch(`/api/method/esign_app.api.get_templetes?user_mail=${o}`,{method:"GET",headers:{"Content-Type":"application/json"}}),b=yield p.json();p.status===200?(m(b.message.data),d(b.message.data)):C("Failed to fetch templates")}catch(p){C("An error occurred while fetching templates")}finally{f(!1)}})},[o,u]),s.useEffect(()=>{D()},[j,w,g,n]);const D=()=>{const t=n.filter(p=>{const b=p.templete_title.toLowerCase().includes(j.toLowerCase()),N=new Date(p.templete_created_at).toISOString().split("T")[0],H=w?N>=w:!0,P=g?N<=g:!0;return b&&H&&P});d(t)},O=t=>{c(`/templete/${t.name}`,{state:{templete:t}})},V=t=>{F(t),h(!0)},$=t=>S(void 0,null,function*(){try{if((yield fetch(`/api/method/esign_app.api.delete_esign_templete?user_mail=${o}&name=${t}`,{method:"POST",headers:{"Content-Type":"application/json"}})).ok){const b=n.filter(N=>N.name!==t);m(b),i(!0)}}catch(p){C("Error deleting template")}finally{h(!1)}}),B=()=>{y(""),T(""),r(""),d(n)};return a?e.jsx("div",{children:"Loading..."}):e.jsxs("div",{className:"relative mt-6 min-w-[1000px] max-w-[1000px] mx-auto",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[e.jsx("input",{type:"text",placeholder:"Search Templates",className:"p-2 rounded bg-[#283C42] text-white placeholder-gray-400 w-1/3",value:j,onChange:t=>y(t.target.value)}),e.jsx("input",{type:"date",className:"p-2 rounded bg-[#283C42] text-white",value:w,onChange:t=>T(t.target.value)}),e.jsx("input",{type:"date",className:"p-2 rounded bg-[#283C42] text-white",value:g,onChange:t=>r(t.target.value)}),e.jsx("button",{className:"bg-[#283C42] text-white border border-white px-4 py-2 rounded hover:bg-white hover:text-[#283C42] transition",onClick:B,children:"Show All"})]}),e.jsx("div",{className:"flex flex-wrap gap-5",children:x.map((t,p)=>e.jsxs("div",{className:"relative flex w-[200px] h-[100px]",children:[e.jsx("div",{className:"absolute top-2 right-2 cursor-pointer",onClick:()=>V(t),children:e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"feather feather-trash-2 text-red-600",children:[e.jsx("polyline",{points:"3 6 5 6 21 6"}),e.jsx("path",{d:"M19 6l-2 14H7L5 6"}),e.jsx("path",{d:"M10 11v6"}),e.jsx("path",{d:"M14 11v6"}),e.jsx("path",{d:"M18 4l-1-1h-8L7 4"})]})}),e.jsxs("div",{className:"bg-[#283C42] text-white rounded border-2 border-transparent hover:border-[#283C42] hover:bg-white hover:text-[#283C42] transition-colors duration-300 cursor-pointer p-4",style:{width:"200px",height:"100px"},onClick:()=>O(t),children:[e.jsx("h3",{className:"mt-2 font-bold text-ellipsis overflow-hidden whitespace-nowrap",children:t.templete_title}),e.jsx("p",{className:"text-sm text-gray-500 text-ellipsis overflow-hidden whitespace-nowrap",children:new Date(t.templete_created_at).toLocaleString()})]})]},p))}),v&&e.jsx(J,{visible:l,name:v.name,message:`Are you sure you want to delete "${v.templete_title}"?`,module:"Template",onCancel:()=>h(!1),onConfirm:()=>$(v.name)})]})};function Z(){const[u,i]=s.useState(!1);return e.jsxs(e.Fragment,{children:[e.jsx(K,{setRefreshTempletes:i}),e.jsx(Q,{refreshTempletes:u,setRefreshTempletes:i})]})}export{Z as default};

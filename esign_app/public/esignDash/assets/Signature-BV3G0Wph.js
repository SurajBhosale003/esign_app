var w=(r,s,e)=>new Promise((I,t)=>{var m=a=>{try{n(e.next(a))}catch(B){t(B)}},E=a=>{try{n(e.throw(a))}catch(B){t(B)}},n=a=>a.done?I(a.value):Promise.resolve(a.value).then(m,E);n((e=e.apply(r,s)).next())});import{r as g,e as x,f as y,j as A,h as j}from"./index-B_YNSGLD.js";import{S as q}from"./SignPad-DWl9dyq_.js";import{Q as H,B as u,Y as d}from"./react-toastify.esm-Dt4eK3tc.js";import{C as P}from"./ConfirmDeleteModal-8k4p4pw2.js";import{L as v,g as L}from"./index-CM3UFs-d.js";import{C as b}from"./index-l_3urzvE.js";import"./index-CHG0Zyb1.js";import"./index-CP83d0q4.js";var D={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M360 184h-8c4.4 0 8-3.6 8-8v8h304v-8c0 4.4 3.6 8 8 8h-8v72h72v-80c0-35.3-28.7-64-64-64H352c-35.3 0-64 28.7-64 64v80h72v-72zm504 72H160c-17.7 0-32 14.3-32 32v32c0 4.4 3.6 8 8 8h60.4l24.7 523c1.6 34.1 29.8 61 63.9 61h454c34.2 0 62.3-26.8 63.9-61l24.7-523H888c4.4 0 8-3.6 8-8v-32c0-17.7-14.3-32-32-32zM731.3 840H292.7l-24.2-512h487l-24.2 512z"}}]},name:"delete",theme:"outlined"},O=function(s,e){return g.createElement(v,L({},s,{ref:e,icon:D}))},N=g.forwardRef(O),k={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M872 474H286.9l350.2-304c5.6-4.9 2.2-14-5.2-14h-88.5c-3.9 0-7.6 1.4-10.5 3.9L155 487.8a31.96 31.96 0 000 48.3L535.1 866c1.5 1.3 3.3 2 5.2 2h91.5c7.4 0 10.8-9.2 5.2-14L286.9 550H872c4.4 0 8-3.6 8-8v-60c0-4.4-3.6-8-8-8z"}}]},name:"arrow-left",theme:"outlined"},_=function(s,e){return g.createElement(v,L({},s,{ref:e,icon:k}))},R=g.forwardRef(_),M={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M869 487.8L491.2 159.9c-2.9-2.5-6.6-3.9-10.5-3.9h-88.5c-7.4 0-10.8 9.2-5.2 14l350.2 304H152c-4.4 0-8 3.6-8 8v60c0 4.4 3.6 8 8 8h585.1L386.9 854c-5.6 4.9-2.2 14 5.2 14h91.5c1.9 0 3.8-.7 5.2-2L869 536.2a32.07 32.07 0 000-48.4z"}}]},name:"arrow-right",theme:"outlined"},U=function(s,e){return g.createElement(v,L({},s,{ref:e,icon:M}))},z=g.forwardRef(U);const{Meta:$}=b,F=({refreshSignatures:r,setRefreshSignatures:s})=>{const e=x(y),[I,t]=g.useState([]),[m,E]=g.useState(!0),[n,a]=g.useState(null),[B,p]=g.useState(!1),[f,K]=g.useState(null),h=g.useRef(null);g.useEffect(()=>{(e||r)&&w(void 0,null,function*(){try{const i=yield fetch(`/api/method/esign_app.api.get_signatures?user_mail=${e}`,{method:"GET",headers:{"Content-Type":"application/json"}}),l=yield i.json();i.status===200?(t(l.message.data),E(!1)):(a(l.message.data.toString()),E(!1))}catch(i){a("An error occurred while fetching signatures"),E(!1)}})},[e,r]);const Y=C=>{K(C),p(!0)},o=()=>{p(!1),K(null)},Q=C=>w(void 0,null,function*(){if(f){try{const l=yield(yield fetch(`/api/method/esign_app.api.cancel_and_delete_esignature?user_mail=${e}&name=${C}`,{method:"POST",headers:{"Content-Type":"application/json"}})).json();l.message.status===200?(u.success("Deleted successfully",{position:"top-right",autoClose:500,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"dark",transition:d}),t(I.filter(G=>G.name!==C)),s(!0)):(u.error("Failed to delete signature",{position:"top-right",autoClose:500,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"dark",transition:d}),console.error("Failed to delete signature:",l.message))}catch(i){u.error("Failed to delete signature",{position:"top-right",autoClose:500,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"dark",transition:d}),console.error("Error deleting signature:",i)}p(!1),K(null)}}),c=C=>{if(h.current){const{scrollLeft:i,clientWidth:l,scrollWidth:G}=h.current,S=C==="left"?Math.max(i-l,0):Math.min(i+l,G-l);h.current.scrollTo({left:S,behavior:"smooth"})}};return m?A.jsx("div",{children:"Loading..."}):n?A.jsxs("div",{children:["Error: ",n]}):A.jsxs("div",{className:"relative mt-6 w-[70vw] mx-auto overflow-hidden",children:[I.length>=3&&A.jsxs(A.Fragment,{children:[A.jsx("button",{className:"scroll-button left absolute left-0 top-1/2 transform -translate-y-1/2 bg-white border border-gray-300 rounded-full shadow-md p-2 cursor-pointer z-10",onClick:()=>c("left"),children:A.jsx(R,{})}),A.jsx("button",{className:"scroll-button right absolute right-0 top-1/2 transform -translate-y-1/2 bg-white border border-gray-300 rounded-full shadow-md p-2 cursor-pointer z-10",onClick:()=>c("right"),children:A.jsx(z,{})})]}),A.jsx("div",{className:"flex gap-4 overflow-x-auto whitespace-nowrap scrollbar-hide",ref:h,children:I.map((C,i)=>A.jsx("div",{className:"inline-block",children:A.jsx(b,{style:{width:300},cover:A.jsx("img",{className:"mt-10 h-30",alt:`Signature ${i+1}`,src:C.sign_blob}),actions:[A.jsx(N,{onClick:()=>Y(C)},"delete")],children:A.jsx($,{title:C.sign_name,description:new Date(C.creation).toLocaleString()})})},i))}),A.jsx(H,{limit:1}),f&&A.jsx(P,{visible:B,name:f.name,onCancel:o,onConfirm:Q,message:"You sure? Wanna delete the sign?",module:"Signature"})]})};function rA(){const[r,s]=g.useState(null),[e,I]=g.useState(null),[t,m]=g.useState(null),[E,n]=g.useState(!1),a=x(j),B=x(y),p=()=>{s(null),I(null),m(null)},f=o=>{n(!1),s(o),I(null)},K=o=>{const c=o.target.value.replace(/\s{2,}/g," ");m(c)},h=()=>w(this,null,function*(){if(r=="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAdYAAAD6CAYAAAAcA2ajAAAKHUlEQVR4Xu3VMQ0AAAzDsJU/6ZHI6QHoYU3KxzhEgQIAAAQKZwLIlQwQIECBAgMAJqycgQIAAAQKhgLCGmKYIECBAgICw+gECBAgQIBAKCGuIaYoAAQIECAirHyBAgAABAqGAsIaYpggQIECAgLD6AQIECBAgEAoIa4hpigABAgQICKsfIECAAAECoYCwhpimCBAgQICAsPoBAgQIECAQCghriGmKAAECBAgIqx8gQIAAAQKhgLCGmKYIECBAgICw+gECBAgQIBAKCGuIaYoAAQIECAirHyBAgAABAqGAsIaYpggQIECAgLD6AQIECBAgEAoIa4hpigABAgQICKsfIECAAAECoYCwhpimCBAgQICAsPoBAgQIECAQCghriGmKAAECBAgIqx8gQIAAAQKhgLCGmKYIECBAgICw+gECBAgQIBAKCGuIaYoAAQIECAirHyBAgAABAqGAsIaYpggQIECAgLD6AQIECBAgEAoIa4hpigABAgQICKsfIECAAAECoYCwhpimCBAgQICAsPoBAgQIECAQCghriGmKAAECBAgIqx8gQIAAAQKhgLCGmKYIECBAgICw+gECBAgQIBAKCGuIaYoAAQIECAirHyBAgAABAqGAsIaYpggQIECAgLD6AQIECBAgEAoIa4hpigABAgQICKsfIECAAAECoYCwhpimCBAgQICAsPoBAgQIECAQCghriGmKAAECBAgIqx8gQIAAAQKhgLCGmKYIECBAgICw+gECBAgQIBAKCGuIaYoAAQIECAirHyBAgAABAqGAsIaYpggQIECAgLD6AQIECBAgEAoIa4hpigABAgQICKsfIECAAAECoYCwhpimCBAgQICAsPoBAgQIECAQCghriGmKAAECBAgIqx8gQIAAAQKhgLCGmKYIECBAgICw+gECBAgQIBAKCGuIaYoAAQIECAirHyBAgAABAqGAsIaYpggQIECAgLD6AQIECBAgEAoIa4hpigABAgQICKsfIECAAAECoYCwhpimCBAgQICAsPoBAgQIECAQCghriGmKAAECBAgIqx8gQIAAAQKhgLCGmKYIECBAgICw+gECBAgQIBAKCGuIaYoAAQIECAirHyBAgAABAqGAsIaYpggQIECAgLD6AQIECBAgEAoIa4hpigABAgQICKsfIECAAAECoYCwhpimCBAgQICAsPoBAgQIECAQCghriGmKAAECBAgIqx8gQIAAAQKhgLCGmKYIECBAgICw+gECBAgQIBAKCGuIaYoAAQIECAirHyBAgAABAqGAsIaYpggQIECAgLD6AQIECBAgEAoIa4hpigABAgQICKsfIECAAAECoYCwhpimCBAgQICAsPoBAgQIECAQCghriGmKAAECBAgIqx8gQIAAAQKhgLCGmKYIECBAgICw+gECBAgQIBAKCGuIaYoAAQIECAirHyBAgAABAqGAsIaYpggQIECAgLD6AQIECBAgEAoIa4hpigABAgQICKsfIECAAAECoYCwhpimCBAgQICAsPoBAgQIECAQCghriGmKAAECBAgIqx8gQIAAAQKhgLCGmKYIECBAgICw+gECBAgQIBAKCGuIaYoAAQIECAirHyBAgAABAqGAsIaYpggQIECAgLD6AQIECBAgEAoIa4hpigABAgQICKsfIECAAAECoYCwhpimCBAgQICAsPoBAgQIECAQCghriGmKAAECBAgIqx8gQIAAAQKhgLCGmKYIECBAgICw+gECBAgQIBAKCGuIaYoAAQIECAirHyBAgAABAqGAsIaYpggQIECAgLD6AQIECBAgEAoIa4hpigABAgQICKsfIECAAAECoYCwhpimCBAgQICAsPoBAgQIECAQCghriGmKAAECBAgIqx8gQIAAAQKhgLCGmKYIECBAgICw+gECBAgQIBAKCGuIaYoAAQIECAirHyBAgAABAqGAsIaYpggQIECAgLD6AQIECBAgEAoIa4hpigABAgQICKsfIECAAAECoYCwhpimCBAgQICAsPoBAgQIECAQCghriGmKAAECBAgIqx8gQIAAAQKhgLCGmKYIECBAgICw+gECBAgQIBAKCGuIaYoAAQIECAirHyBAgAABAqGAsIaYpggQIECAgLD6AQIECBAgEAoIa4hpigABAgQICKsfIECAAAECoYCwhpimCBAgQICAsPoBAgQIECAQCghriGmKAAECBAgIqx8gQIAAAQKhgLCGmKYIECBAgICw+gECBAgQIBAKCGuIaYoAAQIECAirHyBAgAABAqGAsIaYpggQIECAgLD6AQIECBAgEAoIa4hpigABAgQICKsfIECAAAECoYCwhpimCBAgQICAsPoBAgQIECAQCghriGmKAAECBAgIqx8gQIAAAQKhgLCGmKYIECBAgICw+gECBAgQIBAKCGuIaYoAAQIECAirHyBAgAABAqGAsIaYpggQIECAgLD6AQIECBAgEAoIa4hpigABAgQICKsfIECAAAECoYCwhpimCBAgQICAsPoBAgQIECAQCghriGmKAAECBAgIqx8gQIAAAQKhgLCGmKYIECBAgICw+gECBAgQIBAKCGuIaYoAAQIECAirHyBAgAABAqGAsIaYpggQIECAgLD6AQIECBAgEAoIa4hpigABAgQICKsfIECAAAECoYCwhpimCBAgQICAsPoBAgQIECAQCghriGmKAAECBAgIqx8gQIAAAQKhgLCGmKYIECBAgICw+gECBAgQIBAKCGuIaYoAAQIECAirHyBAgAABAqGAsIaYpggQIECAgLD6AQIECBAgEAoIa4hpigABAgQICKsfIECAAAECoYCwhpimCBAgQICAsPoBAgQIECAQCghriGmKAAECBAgIqx8gQIAAAQKhgLCGmKYIECBAgICw+gECBAgQIBAKCGuIaYoAAQIECAirHyBAgAABAqGAsIaYpggQIECAgLD6AQIECBAgEAoIa4hpigABAgQICKsfIECAAAECoYCwhpimCBAgQICAsPoBAgQIECAQCghriGmKAAECBAgIqx8gQIAAAQKhgLCGmKYIECBAgICw+gECBAgQIBAKCGuIaYoAAQIECAirHyBAgAABAqGAsIaYpggQIECAgLD6AQIECBAgEAoIa4hpigABAgQICKsfIECAAAECoYCwhpimCBAgQICAsPoBAgQIECAQCghriGmKAAECBAgIqx8gQIAAAQKhgLCGmKYIECBAgICw+gECBAgQIBAKCGuIaYoAAQIECAirHyBAgAABAqGAsIaYpggQIECAgLD6AQIECBAgEAoIa4hpigABAgQICKsfIECAAAECoYCwhpimCBAgQICAsPoBAgQIECAQCghriGmKAAECBAgIqx8gQIAAAQKhgLCGmKYIECBAgICw+gECBAgQIBAKCGuIaYoAAQIECAirHyBAgAABAqGAsIaYpggQIECAgLD6AQIECBAgEAoIa4hpigABAgQIPObGAPuo15IPAAAAAElFTkSuQmCC"){u.error("Blank Sign-Pad",{position:"top-right",autoClose:500,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"dark",transition:d});return}if(t==""||t==null){u.error("Enter Sign Name",{position:"top-right",autoClose:500,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"dark",transition:d});return}if(t.length<4){u.error("At Least 4 Words Needed",{position:"top-right",autoClose:500,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"dark",transition:d});return}const o={signature_data:r||e,signature_name:t,user_full_name:a,user_email:B};try{const c=yield(yield fetch("/api/method/esign_app.api.save_signature",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)})).json();c.message.status<300?(u.success("Sign Created Successfully",{position:"top-right",autoClose:500,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"dark",transition:d}),p(),n(!0)):alert("Error saving signature: "+c.message)}catch(Q){console.error("Error:",Q),alert("An error occurred while saving the signature")}}),Y=o=>{n(!1),I(o),s(null)};return g.useEffect(()=>{const o=Q=>{Q.key==="Enter"&&(e!=null||r!==null)&&h()};return window.addEventListener("keydown",o),()=>{window.removeEventListener("keydown",o)}},[e,r,t]),A.jsxs("div",{className:" mx-auto mt-8",children:[A.jsx(q,{onSave:f,onUpload:Y}),(r||e)&&A.jsxs("div",{className:"bg-gray-200 p-4 mt-4 flex flex-row",children:[r?A.jsx(A.Fragment,{children:A.jsxs("div",{children:[A.jsx("h2",{className:"text-lg font-semibold mb-2",children:"Signature Preview"}),A.jsx("img",{src:r,alt:"Signature",style:{maxWidth:"100%",height:"250px"},className:"border border-gray-300 rounded"})]})}):e?A.jsx(A.Fragment,{children:A.jsxs("div",{children:[A.jsx("h2",{className:"text-lg font-semibold mb-2",children:"Uploaded Image Preview"}),A.jsx("img",{src:e,alt:"Uploaded Image",style:{maxWidth:"100%",height:"250px"},className:"border border-gray-300 rounded"})]})}):null,A.jsxs("div",{className:"p-5",children:[A.jsx("div",{}),A.jsxs("div",{className:"flex items-center space-x-2 mt-2 gap-1",children:[A.jsx("input",{type:"text",className:"border rounded px-4 py-2 h-10 focus:outline-none",placeholder:"Name of Signature",value:t||"",onChange:K}),A.jsx("button",{onClick:h,className:"bg-white text-[#283C42] px-4 py-2 rounded border-2 border-[#283C42] hover:bg-[#283C42] hover:text-white hover:border-transparent transition-colors duration-300",children:"Save Signature"})]})]})]}),A.jsx(F,{refreshSignatures:E,setRefreshSignatures:n})]})}export{rA as default};

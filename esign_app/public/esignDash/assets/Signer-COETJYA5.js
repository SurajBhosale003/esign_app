var le=Object.defineProperty,de=Object.defineProperties;var oe=Object.getOwnPropertyDescriptors;var F=Object.getOwnPropertySymbols;var ce=Object.prototype.hasOwnProperty,ue=Object.prototype.propertyIsEnumerable;var M=(c,d,r)=>d in c?le(c,d,{enumerable:!0,configurable:!0,writable:!0,value:r}):c[d]=r,v=(c,d)=>{for(var r in d||(d={}))ce.call(d,r)&&M(c,r,d[r]);if(F)for(var r of F(d))ue.call(d,r)&&M(c,r,d[r]);return c},_=(c,d)=>de(c,oe(d));var k=(c,d,r)=>new Promise((m,i)=>{var g=y=>{try{f(r.next(y))}catch(N){i(N)}},S=y=>{try{f(r.throw(y))}catch(N){i(N)}},f=y=>y.done?m(y.value):Promise.resolve(y.value).then(g,S);f((r=r.apply(c,d)).next())});import{r as n,i as he,e as pe,f as ge,u as fe,j as t,M as xe}from"./index-CvZQwJ2C.js";import{Q as me,B as E,Y as T}from"./react-toastify.esm-ZhgozERE.js";import{d as ye,P as be,S as je}from"./SignInput-DEPTeOoI.js";import{e as ve}from"./extractUniqueElements-Cb8tlYgU.js";import{d as U}from"./dayjsConfig-mt5fgA8Q.js";import"./SignPad-Cykf-Qrt.js";import"./index-DvmFvQBp.js";import"./index-LZEUtR-U.js";import"./index-jeq-OB0o.js";const Je=()=>{var A,H;const[c,d]=n.useState(!1),[r,m]=n.useState([]),[i,g]=n.useState(null),[S,f]=n.useState(null),[y,N]=n.useState("");n.useState("");const[x,w]=n.useState(0),[J,O]=n.useState(null),[C,Y]=n.useState(ye),[_e,b]=n.useState(null),V=n.useRef(null),D=n.useRef(null),q=n.useRef(null),L=he(),[Se,Q]=n.useState([]),{documentData:u}=L.state||{},P=pe(ge),$=fe();if(!u)return console.log("No document data",JSON.stringify(u)),t.jsx("p",{children:"Document not found"});n.useEffect(()=>{var e;if(i!==null){const a=r.find(s=>s.id===i);b(a?{id:a.id,type:a.type,checked:(e=a.checked)!=null?e:!1,content:a.content}:null)}},[i,S,r]),n.useEffect(()=>{k(void 0,null,function*(){try{const s=yield(yield fetch(`/api/method/esign_app.api.get_document_components_and_basepdf?document_name=${u?u.name:""}`)).json();if(console.log(s),s.message.document_json_data==null||s.message.base_pdf_datad==null)return;if(s.message.status===200){const l=typeof s.message.document_json_data=="string"?JSON.parse(s.message.document_json_data):s.message.document_json_data,o=typeof s.message.base_pdf_datad=="string"?JSON.parse(s.message.base_pdf_datad):s.message.base_pdf_datad,h=typeof s.message.assigned_users=="string"?JSON.parse(s.message.assigned_users):s.message.assigned_users;O(h),console.log("User Status Document list ------------------>",h);try{for(let j in h)if(h.hasOwnProperty(j)){const p=h[j];if(p.email===P){if(console.log(`Email found at index ${j}, status: ${p.status}`),p.status==="unseen"){p.status="open",h[j]=p,O(h);const ne={document_title:u.name,assigned_user_list:JSON.stringify(h)};try{const B=yield(yield fetch("/api/method/esign_app.api.patch_user_status_document",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(ne)})).json();console.log(JSON.stringify(B)),B.message.status<300}catch(z){console.error("Error:",z)}}else p.status==="close"&&(d(!0),console.log(`Status: ${p.status}`));break}}}catch(j){}console.log("Parrsed data : ",l),m(l),Y(o)}}catch(a){console.error("Error:",a)}}),I()},[]);const I=()=>{const e=ve(r);Q(e)};n.useEffect(()=>{I()},[r]),n.useEffect(()=>{var e;if(i!==null){const a=r.find(s=>s.id===i);b(a?{id:a.id,type:a.type,checked:(e=a.checked)!=null?e:!1,content:a.content}:null)}},[i,S,r]);const W=()=>{x<C.length-1&&(w(x+1),f(null),g(null))},G=()=>k(void 0,null,function*(){console.log("inside Submit Final Doc");const e={document_title:u.name,document_json_data:JSON.stringify(r),iscomplete:!0};console.log(e);try{const s=yield(yield fetch("/api/method/esign_app.api.submit_final_document",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})).json();console.log(JSON.stringify(s)),s.message.status<300?(K(),E.success("Document Submitted Successfully",{position:"top-right",autoClose:500,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"dark",transition:T}),setTimeout(()=>{$("/inbox")},1500)):E.error("Error Submitting Document...",{position:"top-right",autoClose:500,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"dark",transition:T})}catch(a){E.error("Server Error, Please Try Again...",{position:"top-right",autoClose:500,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"dark",transition:T})}}),K=()=>{if(J){const e=v({},J);let a=!1;Object.keys(e).forEach(s=>{e[s].email===P&&e[s].status==="open"&&(e[s].status="close",a=!0,O(e),console.log("Updated data of assigned users:",e),X(e))}),a||console.log('No matching user with "open" status found.')}},X=e=>k(void 0,null,function*(){const a={document_title:u.name,assigned_user_list:JSON.stringify(e)};try{const l=yield(yield fetch("/api/method/esign_app.api.patch_user_status_document",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)})).json();console.log("API response:",l)}catch(s){console.error("Error sending data to API:",s)}}),Z=()=>{x>0&&(w(x-1),f(null),g(null))},ee=e=>{m(a=>a.map(s=>s.id===i?_(v({},s),{content:e,value:e}):s)),f(null),g(null),b(null)},R=()=>{f(null)},te=(e,a)=>{const s=e.target.checked;m(l=>l.map(o=>o.id===a?_(v({},o),{checked:s}):o))},se=(e,a)=>{const s=e.target.value;m(l=>l.map(o=>o.id===a?_(v({},o),{content:s,value:s}):o))},ae=e=>{const a=e.target.value;i!==null&&m(s=>s.map(l=>l.id===i?_(v({},l),{content:a,value:a}):l))},re=e=>{e.target.closest(".component")||(g(null),f(null))};n.useEffect(()=>{if(i!==null){const e=document.querySelector(`[data-id="${i}"]`);f(e);const a=r.find(s=>s.id===i);(a==null?void 0:a.type)==="text"&&N(a.content||"")}},[i,r]),n.useEffect(()=>{if(i!==null){const e=r.find(a=>a.id===i);b(e?{id:e.id,type:e.type,checked:e.checked||!1,content:e.content||""}:null)}},[i,S,r]);const ie=(e,a)=>{var l;const s=(l=e.target.files)==null?void 0:l[0];if(s){const o=new FileReader;o.onloadend=()=>{const h=o.result;m(j=>j.map(p=>p.id===a?_(v({},p),{content:h}):p))},o.readAsDataURL(s)}};return u?t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"text-xs flex items-center gap-3 relative p-6 bg-[#283C42] text-white border-2 border-transparent hover:border-[#283C42] transition-colors duration-300",children:[t.jsx("div",{children:t.jsx("button",{className:"button",onClick:()=>$(-1),children:t.jsxs("div",{className:"button-box",children:[t.jsx("span",{className:"button-elem",children:t.jsx("svg",{viewBox:"0 0 46 40",xmlns:"http://www.w3.org/2000/svg",children:t.jsx("path",{d:"M46 20.038c0-.7-.3-1.5-.8-2.1l-16-17c-1.1-1-3.2-1.4-4.4-.3-1.2 1.1-1.2 3.3 0 4.4l11.3 11.9H3c-1.7 0-3 1.3-3 3s1.3 3 3 3h33.1l-11.3 11.9c-1 1-1.2 3.3 0 4.4 1.2 1.1 3.3.8 4.4-.3l16-17c.5-.5.8-1.1.8-1.9z"})})}),t.jsx("span",{className:"button-elem",children:t.jsx("svg",{viewBox:"0 0 46 40",children:t.jsx("path",{d:"M46 20.038c0-.7-.3-1.5-.8-2.1l-16-17c-1.1-1-3.2-1.4-4.4-.3-1.2 1.1-1.2 3.3 0 4.4l11.3 11.9H3c-1.7 0-3 1.3-3 3s1.3 3 3 3h33.1l-11.3 11.9c-1 1-1.2 3.3 0 4.4 1.2 1.1 3.3.8 4.4-.3l16-17c.5-.5.8-1.1.8-1.9z"})})})]})})}),t.jsxs("div",{children:[t.jsx("h1",{className:"text-xl font-bold ",style:{fontVariant:"small-caps"},children:u.document_title}),t.jsx("p",{className:"text-xs",children:u.template_title}),t.jsxs("p",{className:"text-xs",children:["Email: ",u.owner_email]}),t.jsxs("p",{className:"text-sm",children:["Created At: ",U(u.document_created_at).format("DD/MM/YYYY - HH:mm")," (",U().to(U(u.document_created_at)),")"]})]})]}),t.jsxs("div",{className:`${c?"":"templete-main-div-signer"} `,children:[t.jsxs("div",{className:"templete-app text-xs",children:[t.jsxs("div",{className:"flex gap-3 mb-2",children:[t.jsx("button",{className:"bg-[#283C42] text-white px-4 py-2 rounded border-2 border-transparent hover:border-[#283C42] hover:bg-white hover:text-[#283C42] transition-colors duration-300",onClick:Z,disabled:x===0,children:"Previous"}),t.jsxs("h1",{className:"mt-2",children:[x+1," / ",C.length]}),t.jsx("button",{className:"bg-[#283C42] text-white px-4 py-2 rounded border-2 border-transparent hover:border-[#283C42] hover:bg-white hover:text-[#283C42] transition-colors duration-300",onClick:W,disabled:x===C.length-1,children:"Next"})]}),t.jsxs("div",{className:"workspace",ref:D,onClick:re,children:[t.jsx(be,{pdfData:C[x].data}),r.filter(e=>e.pageNo===x).map(e=>{var a,s,l,o;return t.jsxs("div",{"data-id":e.id,className:` ${e.type} ${i===e.id?"selected":""}`,style:{position:"absolute",top:e.position.top,left:e.position.left,width:(s=(a=e.size)==null?void 0:a.width)!=null?s:0,height:(o=(l=e.size)==null?void 0:l.height)!=null?o:0,border:i===e.id?"1px solid red":"none",fontSize:`${e.fontSize}px`,userSelect:"none",overflow:"hidden"},onClick:h=>{h.stopPropagation(),g(e.id)},children:[e.type==="text"&&t.jsx("div",{style:{width:"100%",height:"100%",overflow:"hidden",fontSize:"inherit",outline:"none"},children:e.value||"Text Here"}),e.type==="image"&&!e.content&&t.jsx("div",{}),e.type==="v_image"&&!e.content&&t.jsx("div",{}),(e.type==="image"||e.type==="v_image"||e.type==="signature"||e.type==="v_signature")&&e.content&&t.jsx("img",{src:e.content,alt:"Uploaded",style:{width:"100%",height:"100%"}}),e.type==="checkbox"&&t.jsx("input",{type:"checkbox",checked:e.checked||!1,readOnly:!0}),e.type==="m_date"&&t.jsx("input",{type:"date",value:e.content||"",readOnly:!0}),e.type==="live_date"&&t.jsx("input",{type:"date",value:new Date().toISOString().split("T")[0],readOnly:!0}),e.type==="fix_date"&&t.jsx("input",{type:"date",value:e.content||"",readOnly:!0}),e.type==="v_text"&&t.jsx("div",{children:e.content||"Editable Text"})]},e.id)}),t.jsx(xe,{ref:V,bounds:{left:0,top:0,right:((A=D.current)==null?void 0:A.offsetWidth)||0,bottom:((H=D.current)==null?void 0:H.offsetHeight)||0}})]})]}),t.jsx("div",{className:`right-div-signer p-5 cursor-pointer ${c?"hidden":""}`,children:t.jsxs("div",{className:"w-full max-w-4xl bg-white rounded-lg shadow-md overflow-hidden ",children:[t.jsx("button",{onClick:G,className:"bg-[#283C42] text-white px-4 py-2 mb-4  border-transparent hover:border-[#283C42] hover:bg-white hover:text-[#283C42] transition-colors duration-300",children:"Submit"}),t.jsxs("table",{className:"w-full signer-table ",children:[t.jsx("thead",{children:t.jsxs("tr",{className:"bg-[#283C42] text-white",children:[t.jsx("th",{className:"py-3 px-4 text-left",children:"Sr."}),t.jsx("th",{className:"py-3 px-4 text-left",children:"Component"}),t.jsx("th",{className:"py-3 px-4 text-left",children:"Page No."}),t.jsx("th",{className:"py-3 px-4 text-left",children:"Input"})]})}),t.jsx("tbody",{children:r.filter(e=>{var a;return(a=e.assign)==null?void 0:a.includes(P)}).map((e,a)=>t.jsxs("tr",{className:`${i===e.id?"selected-row bg-blue-100":""} ${a%2===0?"bg-gray-50":"bg-white"}`,onClick:()=>{g(e.id),w(e.pageNo),R()},children:[t.jsx("td",{className:"py-2 px-4 border-b border-gray-200",children:a+1}),t.jsx("td",{className:"py-2 px-4 border-b border-gray-200",onClick:()=>{g(e.id)},children:e.name}),t.jsx("td",{className:"py-2 px-4 border-b border-gray-200",children:e.pageNo+1}),t.jsxs("td",{className:"py-2 px-4 border-b border-gray-200 max-w-[18vw]",children:[e.type==="signature"&&t.jsx(je,{onSelect:ee,onClickbtn:R}),e.type==="image"&&t.jsx("input",{type:"file",accept:"image/*",onChange:s=>ie(s,e.id)}),e.type==="checkbox"&&t.jsx("input",{type:"checkbox",checked:e.checked||!1,onChange:s=>te(s,e.id)}),(e.type==="m_date"||e.type==="fix_date")&&t.jsx("input",{type:"date",value:e.content||"",onChange:s=>se(s,e.id)}),e.type==="live_date"&&t.jsx("input",{type:"date",value:new Date().toISOString().split("T")[0],readOnly:!0}),e.type==="text"&&t.jsx("input",{className:"bg-[#d1e0e4] text-gray-700 focus:outline-none focus:shadow-outline border border-gray-300 rounded py-2 px-4 block w-full appearance-none",ref:q,type:"text",value:e.content||"",onClick:()=>{g(e.id),w(e.pageNo)},onChange:ae,placeholder:"Edit text here"})]})]},e.id))})]})]})})]}),t.jsx(me,{limit:1})]}):t.jsx("div",{children:"No Doc data available"})};export{Je as default};

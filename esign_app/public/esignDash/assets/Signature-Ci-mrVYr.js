var j=(s,a,t)=>new Promise((d,u)=>{var f=n=>{try{c(t.next(n))}catch(m){u(m)}},h=n=>{try{c(t.throw(n))}catch(m){u(m)}},c=n=>n.done?d(n.value):Promise.resolve(n.value).then(f,h);c((t=t.apply(s,a)).next())});import{r,e as O,f as L,j as e,h as D}from"./index-CJc3YVvY.js";import{S as H}from"./SignPad-CpJIDx4O.js";import{Q as M,B as y,Y as C}from"./react-toastify.esm-B5_L1rj_.js";import{C as A}from"./ConfirmDeleteModal-DCdsMn34.js";import{L as _,g as k}from"./index-B8YOTqs-.js";import{C as R}from"./index-CdvFSca3.js";import"./index-CDeMSOO5.js";import"./index-TbHCSSDf.js";var B={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M360 184h-8c4.4 0 8-3.6 8-8v8h304v-8c0 4.4 3.6 8 8 8h-8v72h72v-80c0-35.3-28.7-64-64-64H352c-35.3 0-64 28.7-64 64v80h72v-72zm504 72H160c-17.7 0-32 14.3-32 32v32c0 4.4 3.6 8 8 8h60.4l24.7 523c1.6 34.1 29.8 61 63.9 61h454c34.2 0 62.3-26.8 63.9-61l24.7-523H888c4.4 0 8-3.6 8-8v-32c0-17.7-14.3-32-32-32zM731.3 840H292.7l-24.2-512h487l-24.2 512z"}}]},name:"delete",theme:"outlined"},P=function(a,t){return r.createElement(_,k({},a,{ref:t,icon:B}))},$=r.forwardRef(P),z={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M872 474H286.9l350.2-304c5.6-4.9 2.2-14-5.2-14h-88.5c-3.9 0-7.6 1.4-10.5 3.9L155 487.8a31.96 31.96 0 000 48.3L535.1 866c1.5 1.3 3.3 2 5.2 2h91.5c7.4 0 10.8-9.2 5.2-14L286.9 550H872c4.4 0 8-3.6 8-8v-60c0-4.4-3.6-8-8-8z"}}]},name:"arrow-left",theme:"outlined"},T=function(a,t){return r.createElement(_,k({},a,{ref:t,icon:z}))},F=r.forwardRef(T),U={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M869 487.8L491.2 159.9c-2.9-2.5-6.6-3.9-10.5-3.9h-88.5c-7.4 0-10.8 9.2-5.2 14l350.2 304H152c-4.4 0-8 3.6-8 8v60c0 4.4 3.6 8 8 8h585.1L386.9 854c-5.6 4.9-2.2 14 5.2 14h91.5c1.9 0 3.8-.7 5.2-2L869 536.2a32.07 32.07 0 000-48.4z"}}]},name:"arrow-right",theme:"outlined"},W=function(a,t){return r.createElement(_,k({},a,{ref:t,icon:U}))},V=r.forwardRef(W);const{Meta:Y}=R,G=({refreshSignatures:s,setRefreshSignatures:a})=>{const t=O(L),[d,u]=r.useState([]),[f,h]=r.useState(!0),[c,n]=r.useState(null),[m,w]=r.useState(!1),[v,p]=r.useState(null),x=r.useRef(null);r.useEffect(()=>{(t||s)&&j(void 0,null,function*(){try{const i=yield fetch(`/api/method/esign_app.api.get_signatures?user_mail=${t}`,{method:"GET",headers:{"Content-Type":"application/json"}}),g=yield i.json();i.status===200?(u(g.message.data),h(!1)):(n(g.message.data.toString()),h(!1))}catch(i){n("An error occurred while fetching signatures"),h(!1)}})},[t,s]);const o=l=>{p(l),w(!0)},b=()=>{w(!1),p(null)},S=l=>j(void 0,null,function*(){if(v){try{const g=yield(yield fetch(`/api/method/esign_app.api.cancel_and_delete_esignature?user_mail=${t}&name=${l}`,{method:"POST",headers:{"Content-Type":"application/json"}})).json();g.message.status===200?(y.success("Deleted successfully",{position:"top-right",autoClose:500,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"dark",transition:C}),u(d.filter(N=>N.name!==l)),a(!0)):(y.error("Failed to delete signature",{position:"top-right",autoClose:500,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"dark",transition:C}),console.error("Failed to delete signature:",g.message))}catch(i){y.error("Failed to delete signature",{position:"top-right",autoClose:500,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"dark",transition:C}),console.error("Error deleting signature:",i)}w(!1),p(null)}}),E=l=>{if(x.current){const{scrollLeft:i,clientWidth:g,scrollWidth:N}=x.current,I=l==="left"?Math.max(i-g,0):Math.min(i+g,N-g);x.current.scrollTo({left:I,behavior:"smooth"})}};return f?e.jsx("div",{children:"Loading..."}):c?e.jsxs("div",{children:["Error: ",c]}):e.jsxs("div",{className:"relative mt-6 min-w-[1000px] max-w-[1000px] mx-auto pl-10 pr-10",children:[d.length>=3&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"scroll-button left absolute left-0 top-1/2 transform -translate-y-1/2 bg-white border border-gray-300 rounded-full shadow-md p-2 cursor-pointer z-10",onClick:()=>E("left"),children:e.jsx(F,{})}),e.jsx("button",{className:"scroll-button right absolute right-0 top-1/2 transform -translate-y-1/2 bg-white border border-gray-300 rounded-full shadow-md p-2 cursor-pointer z-10",onClick:()=>E("right"),children:e.jsx(V,{})})]}),e.jsx("div",{className:"flex gap-4 overflow-x-auto whitespace-nowrap scrollbar-hide",ref:x,children:d.map((l,i)=>e.jsx("div",{className:"inline-block",children:e.jsx(R,{style:{width:300},cover:e.jsx("img",{className:"mt-10 h-30",alt:`Signature ${i}`,src:l.sign_blob}),actions:[e.jsx($,{onClick:()=>o(l)},"delete")],children:e.jsx(Y,{title:l.sign_name,description:new Date(l.creation).toLocaleString()})})},i))}),e.jsx(M,{limit:1}),v&&e.jsx(A,{visible:m,name:v.name,onCancel:b,onConfirm:S,message:"You sure ? wanna delete the sign?",module:"Signature"})]})};function se(){const[s,a]=r.useState(null),[t,d]=r.useState(null),[u,f]=r.useState(null),[h,c]=r.useState(!1),n=O(D),m=O(L),w=o=>{c(!1),a(o),d(null)},v=o=>{f(o.target.value)},p=()=>j(this,null,function*(){const o={signature_data:s||t,signature_name:u,user_full_name:n,user_email:m};try{const S=yield(yield fetch("/api/method/esign_app.api.save_signature",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)})).json();S.message.status<300?(y.success("Sign Created Successfully",{position:"top-right",autoClose:500,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"dark",transition:C}),d(null),a(null),f(""),c(!0)):alert("Error saving signature: "+S.message)}catch(b){console.error("Error:",b),alert("An error occurred while saving the signature")}}),x=o=>{c(!1),d(o),a(null)};return r.useEffect(()=>{const o=b=>{b.key==="Enter"&&p()};return window.addEventListener("keydown",o),()=>{window.removeEventListener("keydown",o)}},[t,s,u]),e.jsxs("div",{className:"max-w-lg mx-auto mt-8",children:[e.jsx(H,{onSave:w,onUpload:x}),s&&e.jsxs("div",{className:"bg-gray-200 p-4 mt-4",children:[e.jsx("h2",{className:"text-lg font-semibold mb-2",children:"Signature Preview"}),e.jsx("img",{src:s,alt:"Signature",style:{maxWidth:"100%",height:"90px"},className:"border border-gray-300 rounded"}),e.jsxs("div",{className:"flex items-center space-x-2 mt-2 gap-1",children:[e.jsx("input",{type:"text",className:"border rounded px-4 py-2 h-10 focus:outline-none",placeholder:"Name of Signature",value:u||"",onChange:v}),e.jsx("button",{onClick:p,className:"bg-white text-[#283C42] px-4 py-2 rounded border-2 border-[#283C42] hover:bg-[#283C42] hover:text-white hover:border-transparent transition-colors duration-300",children:"Save Signature"})]})]}),t&&!s&&e.jsxs("div",{className:"bg-gray-200 p-4 mt-4",children:[e.jsx("h2",{className:"text-lg font-semibold mb-2",children:"Uploaded Image Preview"}),e.jsx("img",{src:t,alt:"Uploaded Image",style:{maxWidth:"100%",height:"auto"},className:"border border-gray-300 rounded"}),e.jsxs("div",{className:"flex items-center space-x-2 mt-2 gap-1",children:[e.jsx("input",{type:"text",className:"border rounded px-4 py-2 focus:outline-none",placeholder:"Name of Signature",onChange:v}),e.jsx("button",{onClick:p,className:"bg-white text-[#283C42] px-4 py-2 rounded border-2 border-[#283C42] hover:bg-[#283C42] hover:text-white hover:border-transparent transition-colors duration-300",children:"Save Signature"})]})]}),e.jsx(G,{refreshSignatures:h,setRefreshSignatures:c})]})}export{se as default};

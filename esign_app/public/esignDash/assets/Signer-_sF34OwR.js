var ft=Object.defineProperty,xt=Object.defineProperties;var bt=Object.getOwnPropertyDescriptors;var Oe=Object.getOwnPropertySymbols;var yt=Object.prototype.hasOwnProperty,jt=Object.prototype.propertyIsEnumerable;var Pe=(h,u,n)=>u in h?ft(h,u,{enumerable:!0,configurable:!0,writable:!0,value:n}):h[u]=n,z=(h,u)=>{for(var n in u||(u={}))yt.call(u,n)&&Pe(h,n,u[n]);if(Oe)for(var n of Oe(u))jt.call(u,n)&&Pe(h,n,u[n]);return h},V=(h,u)=>xt(h,bt(u));var C=(h,u,n)=>new Promise((p,l)=>{var x=y=>{try{b(n.next(y))}catch(E){l(E)}},v=y=>{try{b(n.throw(y))}catch(E){l(E)}},b=y=>y.done?p(y.value):Promise.resolve(y.value).then(x,v);b((n=n.apply(h,u)).next())});import{c as ce,e as Ae,r as o,i as wt,j as t,k as vt,u as St,M as _t}from"./index-0nKeV5mV.js";import{B as A,Y as H,Q as Ct}from"./react-toastify.esm-Dgz2zfA7.js";import{P as Te,S as Nt,r as q,a as ae,b as w}from"./PDFButton-Z4hNujZT.js";import{B as kt,P as Dt}from"./BlankPDF-CpqlvkOA.js";import{S as Ot}from"./SignPad-BnQpJFVv.js";import{M as Ee}from"./index-gDlXHgX-.js";import{T as Ie}from"./index-BHP3nk3e.js";import{R as Pt,e as Tt}from"./extractUniqueElements-DoaRpADM.js";import{d as le}from"./dayjsConfig-DOSRkPgf.js";import{C as Rt}from"./ConfirmDeleteModal-dRA6CzTo.js";import"./PurePanel-BDIKaUYK.js";import"./index-gXNO_Cjl.js";const{TabPane:Re}=Ie,At=({onSelect:h,onClickbtn:u})=>{const n=ce(Ae);o.useRef(null);const[p,l]=o.useState(!1),[x,v]=o.useState(null),[b,y]=o.useState(null),[E,j]=o.useState([]),[N,D]=o.useState(null),[O,W]=o.useState(!1),G=ce(wt),[L,k]=o.useState("1"),ne=m=>{W(!1),D(m),v(null)},$=m=>{y(m.target.value)},P=()=>C(void 0,null,function*(){const m={signature_data:N||x,signature_name:b,user_full_name:G,user_email:n};try{const I=yield(yield fetch("/api/method/esign_app.api.save_signature",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(m)})).json();I.message.status<300?(A.success("Sign Created Successfully",{position:"top-right",autoClose:500,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"dark",transition:H}),v(null),D(null),y(""),W(!0)):alert("Error saving signature: "+I.message)}catch(S){console.error("Error:",S),alert("An error occurred while saving the signature")}k("1")}),oe=m=>{W(!1),v(m),D(null)};o.useEffect(()=>{(n||O)&&C(void 0,null,function*(){try{const S=yield fetch(`/api/method/esign_app.api.get_signatures?user_mail=${n}`,{method:"GET",headers:{"Content-Type":"application/json"}}),I=yield S.json();S.status===200&&(j(I.message.data),console.log(`++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
`,I.message.data))}catch(S){}})},[n,O]);const de=()=>{l(!0),u()},T=()=>{l(!1)},re=(m,S,I)=>{h(m,S,I),T()};return t.jsxs(t.Fragment,{children:[t.jsx("button",{className:"bg-[#283C42] w-full text-white px-4 py-2 rounded border-2 border-transparent hover:border-[#283C42] hover:bg-white hover:text-[#283C42] transition-colors duration-300",onClick:de,children:"Sign"}),t.jsx(Ee,{title:"Signature List",open:p,onCancel:T,footer:[,],width:"70vw",children:t.jsx("div",{className:"min-h-[60vh]",children:t.jsxs(Ie,{activeKey:L,onChange:k,children:[t.jsx(Re,{tab:"All Signatures",children:t.jsx("div",{className:"all-sign-div",children:E.map((m,S)=>t.jsxs("div",{className:"card",onClick:()=>re(m.sign_blob,m.cert_pem,m.openssl_name),children:[t.jsx("img",{alt:`Signature ${S}`,src:m.sign_blob,className:"card__image"}),t.jsxs("div",{className:"card__content",children:[t.jsx("p",{className:"card__title",children:m.sign_name}),t.jsx("p",{className:"card__description",children:new Date(m.creation).toLocaleString()})]})]},S))})},"1"),t.jsxs(Re,{tab:"New Signature",children:[t.jsx(Ot,{onSave:ne,onUpload:oe}),N&&t.jsxs("div",{className:"bg-gray-200 p-4 mt-4",children:[t.jsx("h2",{className:"text-lg font-semibold mb-2",children:"Signature Preview"}),t.jsx("img",{src:N,alt:"Signature",style:{maxWidth:"100%",height:"90px"},className:"border border-gray-300 rounded"}),t.jsxs("div",{className:"flex items-center space-x-2 mt-2 gap-1",children:[t.jsx("input",{type:"text",className:"border rounded px-4 py-2 h-10 focus:outline-none",placeholder:"Name of Signature",value:b||"",onChange:$}),t.jsx("button",{onClick:P,className:"bg-white text-[#283C42] px-4 py-2 rounded border-2 border-[#283C42] hover:bg-[#283C42] hover:text-white hover:border-transparent transition-colors duration-300",children:"Save Signature"})]})]}),x&&!N&&t.jsxs("div",{className:"bg-gray-200 p-4 mt-4",children:[t.jsx("h2",{className:"text-lg font-semibold mb-2",children:"Uploaded Image Preview"}),t.jsx("img",{src:x,alt:"Uploaded Image",style:{maxWidth:"100%",height:"auto"},className:"border border-gray-300 rounded"}),t.jsxs("div",{className:"flex items-center space-x-2 mt-2 gap-1",children:[t.jsx("input",{type:"text",className:"border rounded px-4 py-2 focus:outline-none",placeholder:"Name of Signature",onChange:$}),t.jsx("button",{onClick:P,className:"bg-white text-[#283C42] px-4 py-2 rounded border-2 border-[#283C42] hover:bg-[#283C42] hover:text-white hover:border-transparent transition-colors duration-300",children:"Save Signature"})]})]})]},"2")]})})})]})};function Et(h){return new Promise((u,n)=>{const p=new FileReader;p.onloadend=()=>{p.result&&typeof p.result=="string"?u(p.result.split(",")[1]):n(new Error("FileReader did not return a string result"))},p.onerror=l=>n(l),p.readAsDataURL(h)})}function It(h,u="application/pdf"){return C(this,null,function*(){return new Promise((n,p)=>{try{const l=atob(h),x=new Array(l.length);for(let y=0;y<l.length;y++)x[y]=l.charCodeAt(y);const v=new Uint8Array(x),b=new Blob([v],{type:u});n(b)}catch(l){p(new Error("Failed to convert Base64 to Blob: "+l))}})})}const Ut=({visible:h,onCancel:u,onConfirm:n,name:p,owner_name:l,message:x,module:v})=>{const[b,y]=o.useState("");function E(j,N){return C(this,null,function*(){const D=document.createElement("div");D.innerHTML=N;const O=D.textContent||D.innerText||"";if(!(O.replace(/[^a-zA-Z]/g,"").length>=5)){A.error("Reason must contain at least 5 alphabetic characters.");return}console.log(j,O);const G={document_title:j,document_reason:N,document_owner:l};try{const k=yield(yield fetch("/api/method/esign_app.api.reject_final_document",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(G)})).json();if(console.log(JSON.stringify(k)),k.message.status===200)A.success(k.message),n(j,O),y("");else throw new Error(k.message)}catch(L){console.error("Error rejecting document:",L),A.error("Failed to reject document. Please try again.")}})}return t.jsx(Ee,{title:"",visible:h,onCancel:u,footer:null,width:"fit-content",className:"!p-0 glass-modal",children:t.jsxs("div",{className:"min-w-[40vw] p-6  text-white ",children:[t.jsxs("div",{children:[t.jsx("div",{className:"flex mx-auto bg-red-500/20 shrink-0 justify-center items-center w-12 h-12 rounded-full",children:t.jsx("svg",{"aria-hidden":"true",stroke:"currentColor",strokeWidth:"1.5",viewBox:"0 0 24 24",fill:"none",className:"w-6 h-6 text-red-500",children:t.jsx("path",{d:"M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126zM12 15.75h.007v.008H12v-.008z",strokeLinejoin:"round",strokeLinecap:"round"})})}),t.jsxs("div",{className:"mt-4 text-center",children:[t.jsx("span",{className:"text-white text-base font-semibold leading-6",children:v}),t.jsx("p",{className:"mt-2 text-gray-300 text-sm leading-5",children:x})]})]}),t.jsxs("div",{className:"mt-6 mb-4",children:[t.jsx("label",{className:"block font-semibold text-white mb-2",children:"Reason for Rejection:"}),t.jsx("div",{className:"bg-white rounded-md overflow-hidden",children:t.jsx(Pt,{theme:"snow",value:b,className:"text-black",onChange:y})})]}),t.jsxs("div",{className:"mt-4 space-y-2",children:[t.jsx("button",{type:"button",onClick:()=>E(p,b),disabled:!b.trim(),className:"w-full inline-flex justify-center rounded-md bg-red-600 text-white px-4 py-2 text-sm font-medium border border-transparent shadow-sm hover:bg-red-700 transition disabled:opacity-50 disabled:cursor-not-allowed",children:"Confirm"}),t.jsx("button",{type:"button",onClick:u,className:"w-full inline-flex justify-center rounded-md bg-white/10 text-white px-4 py-2 text-sm font-medium border border-white/20 shadow-sm hover:bg-white/20 transition",children:"Cancel"})]})]})})},Qt=()=>{var be,ye;const[h,u]=o.useState(!1),[n,p]=o.useState([]),[l,x]=o.useState(null),[v,b]=o.useState(null),[y,E]=o.useState("");o.useState("");const[j,N]=o.useState(0),[D,O]=o.useState(null),[W,G]=o.useState([]),[L,k]=o.useState(!1),[ne,$]=o.useState(!1),[P,oe]=o.useState(kt),[de,T]=o.useState(null),re=o.useRef(null),m=o.useRef(null),S=o.useRef(null),I=vt(),[Mt,Ue]=o.useState([]),[Q,X]=o.useState(0),[ue,Me]=o.useState(0),{documentData:f}=I.state||{},[he,ge]=o.useState([]);o.useState("");const ie=ce(Ae),Be=St();if(!f)return console.log("No document data",JSON.stringify(f)),t.jsx("p",{children:"Document not found"});o.useEffect(()=>{var e;if(l!==null){const s=n.find(a=>a.id===l);T(s?{id:s.id,type:s.type,checked:(e=s.checked)!=null?e:!1,content:s.content}:null)}},[l,v,n]),o.useEffect(()=>{console.log("Fetch Data before if useEffect  --->>>>>"),Q||(console.log("Fetch Data Inside if isCompleted --->>>>>"),C(void 0,null,function*(){try{console.log("Fetch Data Inside function inside try --->>>>>");const s=yield fetch(`/api/method/esign_app.api.get_assigned_users_list_check?user_document_name=${f.name}`,{method:"GET",headers:{"Content-Type":"application/json"}});if(s.ok){console.log("response Is OK --->>>>>");const a=yield s.json();G(a.message.data.assigned_users||[]),ge(a.message.data.opensslusedlist||[]),Me(a.message.data.isRejected||0),console.log("Data OPen SSL =======>",a.message.data.opensslusedlist);const r=JSON.parse(a.message.data.assigned_users);console.log("here is Assigned user List data",r);const i={unseen:0,open:0,close:0};if(Object.values(r).forEach(d=>{d.status in i&&i[d.status]++}),console.log(i,"-------------------->IMG Count-------------"),i.unseen>0){X(0);return}if(i.open>0){X(0);return}i.open+i.unseen==0&&(X(1),Fe())}else console.error("Error fetching data:",s.statusText)}catch(s){console.error("Fetch error:",s)}finally{}}))},[]);const Fe=()=>C(void 0,null,function*(){console.log("inside updateDocumentStatus");try{const e=yield fetch(`/api/method/esign_app.api.update_document_status_confirm?user_document_name=${f.name}`,{method:"POST",headers:{"Content-Type":"application/json"}});if(e.ok){console.log("inside updateDocumentStatus ------------> OK");const s=yield e.json();console.log(s.message,"Document status updated successfully.",Q)}}catch(e){console.error("Fetch error:",e)}finally{}});o.useEffect(()=>{C(void 0,null,function*(){try{const a=yield(yield fetch(`/api/method/esign_app.api.get_document_components_and_basepdf?document_name=${f?f.name:""}`)).json();if(console.log(a),a.message.document_json_data==null||a.message.base_pdf_datad==null)return;if(a.message.status===200){X(a.message.iscompleted);const r=typeof a.message.document_json_data=="string"?JSON.parse(a.message.document_json_data):a.message.document_json_data,i=typeof a.message.base_pdf_datad=="string"?JSON.parse(a.message.base_pdf_datad):a.message.base_pdf_datad,d=typeof a.message.assigned_users=="string"?JSON.parse(a.message.assigned_users):a.message.assigned_users;O(d),console.log("User Status Document list ------------------>",d);try{for(let U in d)if(d.hasOwnProperty(U)){const _=d[U];if(_.email===ie){if(console.log(`Email found at index ${U}, status: ${_.status}`),_.status==="unseen"){_.status="open",d[U]=_,O(d);const Z={document_title:f.name,assigned_user_list:JSON.stringify(d)};try{const K=yield(yield fetch("/api/method/esign_app.api.patch_user_status_document",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(Z)})).json();console.log(JSON.stringify(K)),K.message.status<300}catch(Y){console.error("Error:",Y)}}else _.status==="close"&&(u(!0),console.log(`Status: ${_.status}`));break}}}catch(U){}console.log("Parrsed data : ",r),p(r),oe(i)}}catch(s){console.error("Error:",s)}}),pe()},[]);const pe=()=>{const e=Tt(n);Ue(e)};o.useEffect(()=>{pe()},[n]),o.useEffect(()=>{var e;if(l!==null){const s=n.find(a=>a.id===l);T(s?{id:s.id,type:s.type,checked:(e=s.checked)!=null?e:!1,content:s.content}:null)}},[l,v,n]);const ze=()=>{j<P.length-1&&(N(j+1),b(null),x(null))},He=()=>C(void 0,null,function*(){at();try{const s=yield(yield fetch("/api/method/esign_app.api.generate_and_sign_pdf",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({document_name:f.name})})).json();console.log(JSON.stringify(s));const a=yield It(s.message);console.log(s.signed_pdf_base64);const r=URL.createObjectURL(a),i=`esignDoc-${f.document_title}`,d=document.createElement("a");d.href=r,d.download=`${i}.pdf`,document.body.appendChild(d),d.click(),document.body.removeChild(d),URL.revokeObjectURL(r),s.message.status<300?(A.success("PDF genrated Successfully",{position:"top-right",autoClose:500,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"dark",transition:H}),setTimeout(()=>{window.open(s.message.pdf_url,"_blank")},2500)):console.error("Error printing PDF:",s.message.error)}catch(e){console.error("Error:",e)}}),Le=()=>C(void 0,null,function*(){const e={document_title:f.name,document_json_data:JSON.stringify(n),opensslusedlist:he};try{const a=yield(yield fetch("/api/method/esign_app.api.submit_final_document",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})).json();console.log(JSON.stringify(a)),a.message.status<300?(me(),A.success("Document Submitted Successfully",{position:"top-right",autoClose:500,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"dark",transition:H}),setTimeout(()=>{window.location.reload()},2e3)):A.error("Error Submitting Document...",{position:"top-right",autoClose:500,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"dark",transition:H})}catch(s){A.error("Server Error, Please Try Again...",{position:"top-right",autoClose:500,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"dark",transition:H})}}),me=()=>{if(D){const e=z({},D);let s=!1;Object.keys(e).forEach(a=>{e[a].email===ie&&e[a].status==="open"&&(e[a].status="close",s=!0,O(e),console.log("Updated data of assigned users:",e),Ke(e))}),s||console.log('No matching user with "open" status found.')}},$e=()=>{k(!1)},Je=()=>{Le(),k(!1)},Ve=()=>{k(!0)},We=()=>{$(!0)},Ge=()=>{$(!1)},Ye=()=>{me(),A.success("Document rejected Successfully",{position:"top-right",autoClose:500,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"dark",transition:H}),setTimeout(()=>{window.location.reload()},2e3),$(!1)},Ke=e=>C(void 0,null,function*(){const s={document_title:f.name,assigned_user_list:JSON.stringify(e)};try{const r=yield(yield fetch("/api/method/esign_app.api.patch_user_status_document",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)})).json();console.log("API response:",r)}catch(a){console.error("Error sending data to API:",a)}}),qe=()=>{j>0&&(N(j-1),b(null),x(null))},Qe=(e,s,a)=>{p(r=>r.map(i=>i.id===l?V(z({},i),{content:e,value:e,cert_pem:s}):i)),ge(r=>{const i=typeof r=="string"?JSON.parse(r):r;if(!Array.isArray(i))return console.error("prevList is not an array:",i),[];const d=[...i,{name:a,status:"notapplied"}];return console.log("Updated List:",d),d}),console.log(a),console.log(he),b(null),x(null),T(null)},fe=()=>{b(null)},Xe=(e,s)=>{const a=e.target.checked;p(r=>r.map(i=>i.id===s?V(z({},i),{checked:a}):i))},Ze=(e,s)=>{const a=e.target.value;p(r=>r.map(i=>i.id===s?V(z({},i),{content:a,value:a}):i))},et=e=>{const s=e.target.value;l!==null&&p(a=>a.map(r=>r.id===l?V(z({},r),{content:s,value:s}):r))},tt=e=>{e.target.closest(".component")||(x(null),b(null))};o.useEffect(()=>{if(l!==null){const e=document.querySelector(`[data-id="${l}"]`);b(e);const s=n.find(a=>a.id===l);(s==null?void 0:s.type)==="text"&&E(s.content||"")}},[l,n]),o.useEffect(()=>{if(l!==null){const e=n.find(s=>s.id===l);T(e?{id:e.id,type:e.type,checked:e.checked||!1,content:e.content||""}:null)}},[l,v,n]);const xe=e=>Uint8Array.from(atob(e),s=>s.charCodeAt(0)),st=(e,s)=>{var r;const a=(r=e.target.files)==null?void 0:r[0];if(a){const i=new FileReader;i.onloadend=()=>{const d=i.result;p(U=>U.map(_=>_.id===s?V(z({},_),{content:d}):_))},i.readAsDataURL(a)}},at=()=>C(void 0,null,function*(){var Z,Y,K,je,we,ve,Se,_e;const e=yield Te.create(),s=yield e.embedFont(Nt.TimesRoman);for(let g=0;g<P.length;g++){const M=xe(P[g].data),ee=yield Te.load(M);(yield e.copyPages(ee,ee.getPageIndices())).forEach(F=>e.addPage(F))}const a=n.reduce((g,M)=>(g[M.pageNo]||(g[M.pageNo]=[]),g[M.pageNo].push(M),g),{}),r=e.getPages();for(const g of r){const M=r.indexOf(g),ee=a[M]||[];for(const c of ee){const{left:F,top:te}=c.position;if(c.type==="text"||c.type==="v_text"){const R=(Z=c.fontSize)!=null?Z:12,B=g.getHeight()-te-R-3;g.drawText(c.content||"",{x:F+3,y:B,size:R,color:q(0,0,0),lineHeight:R*1.2,maxWidth:(K=(Y=c.size)==null?void 0:Y.width)!=null?K:0,font:s})}else if((c.type==="image"||c.type==="v_image"||c.type==="v_signature"||c.type==="signature")&&c.content){const R=c.content.split(",")[1];if(!R){console.error("Invalid image data");continue}if(c.type==="signature"){const ht=c.name||"Unknown",gt=new Date().toISOString(),pt=ae.of(`Certificate: ${c.cert_pem}
Signer: ${ht}
SignedAt: ${gt}`),mt=e.context.obj({Type:w.of("Annot"),Subtype:w.of("Widget"),T:ae.of(`Signature_${M}_${c.name}`),Contents:pt,Rect:[0,0,0,0],P:g.ref,F:4});let se=g.node.lookup(w.of("Annots"));se||(se=e.context.obj([]),g.node.set(w.of("Annots"),se)),se.push(mt),g.node.set(w.of("Group"),e.context.obj({Type:w.of("Group"),S:w.of("Transparency"),CS:w.of("DeviceRGB")})),console.log(`Certificate embedded as annotation for ${c.name}`)}const B=xe(R);let J;if(c.content.startsWith("data:image/png"))J=yield e.embedPng(B);else if(c.content.startsWith("data:image/jpeg")||c.content.startsWith("data:image/jpg"))J=yield e.embedJpg(B);else{console.error("Unsupported image format");continue}const{width:Ce,height:Ne}=J,ot=(we=(je=c.size)==null?void 0:je.width)!=null?we:0,rt=(Se=(ve=c.size)==null?void 0:ve.height)!=null?Se:0,it=ot/Ce,lt=rt/Ne,ke=Math.min(it,lt),ct=Ce*ke,De=Ne*ke,dt=F,ut=g.getHeight()-te-De;g.drawImage(J,{x:dt,y:ut,width:ct,height:De})}else if(c.type==="checkbox"){const B=g.getHeight()-te-10-5;c.checked?g.drawRectangle({x:F+5,y:B,width:10,height:10,color:q(0,0,0)}):g.drawRectangle({x:F+5,y:B,width:10,height:10,borderColor:q(0,0,0),borderWidth:1,color:q(1,1,1)})}else if(c.type==="m_date"||c.type==="live_date"||c.type==="fix_date"){const R=(_e=c.fontSize)!=null?_e:12,B=g.getHeight()-te-R-3,J=c.content||new Date().toLocaleDateString();g.drawText(J,{x:F+3,y:B,size:R,color:q(0,0,0),font:s})}}}e.catalog.set(w.of("OutputIntent"),e.context.obj({Type:w.of("OutputIntent"),S:w.of("GTS_PDFA1"),OutputConditionIdentifier:ae.of("sRGB IEC61966-2.1"),Info:ae.of("sRGB IEC61966-2.1")}));const i=e.context.obj({Type:w.of("Metadata"),Subtype:w.of("XML"),Length:0});e.catalog.set(w.of("Metadata"),i),e.setTitle("Document signed by eSign"),e.setAuthor("Dexciss Technology"),e.setSubject("eSign"),e.setKeywords(["Dexciss Technology","eSign"]),e.setCreationDate(new Date),e.setModificationDate(new Date);const d=yield e.save(),U=new Blob([d],{type:"application/pdf"}),_=yield Et(U);console.log("lvl1"),nt(_),A.success("PDF Has Been Merged",{position:"top-right",autoClose:500,hideProgressBar:!1,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0,theme:"dark",transition:H})}),nt=e=>C(void 0,null,function*(){const s={document_title:f.name,validated_pdf:e};console.log("inside merge and save");try{const a=yield fetch("/api/method/esign_app.api.mergeAndPrintSave",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(!a.ok)throw new Error("Failed to process the document.");const r=yield a.json();return console.log("Document processed successfully:",r),r}catch(a){throw console.error("Error in mergeAndPrintSave:",a),a}});return f?t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"text-xs flex items-center gap-3 relative p-6 bg-[#283C42] text-white border-2 border-transparent hover:border-[#283C42] transition-colors duration-300",children:[t.jsx("div",{children:t.jsx("button",{className:"button",onClick:()=>Be(-1),children:t.jsxs("div",{className:"button-box",children:[t.jsx("span",{className:"button-elem",children:t.jsx("svg",{viewBox:"0 0 46 40",xmlns:"http://www.w3.org/2000/svg",children:t.jsx("path",{d:"M46 20.038c0-.7-.3-1.5-.8-2.1l-16-17c-1.1-1-3.2-1.4-4.4-.3-1.2 1.1-1.2 3.3 0 4.4l11.3 11.9H3c-1.7 0-3 1.3-3 3s1.3 3 3 3h33.1l-11.3 11.9c-1 1-1.2 3.3 0 4.4 1.2 1.1 3.3.8 4.4-.3l16-17c.5-.5.8-1.1.8-1.9z"})})}),t.jsx("span",{className:"button-elem",children:t.jsx("svg",{viewBox:"0 0 46 40",children:t.jsx("path",{d:"M46 20.038c0-.7-.3-1.5-.8-2.1l-16-17c-1.1-1-3.2-1.4-4.4-.3-1.2 1.1-1.2 3.3 0 4.4l11.3 11.9H3c-1.7 0-3 1.3-3 3s1.3 3 3 3h33.1l-11.3 11.9c-1 1-1.2 3.3 0 4.4 1.2 1.1 3.3.8 4.4-.3l16-17c.5-.5.8-1.1.8-1.9z"})})})]})})}),t.jsxs("div",{children:[t.jsx("h1",{className:"text-xl font-bold ",style:{fontVariant:"small-caps"},children:f.document_title}),t.jsx("p",{className:"text-xs",children:f.template_title}),t.jsxs("p",{className:"text-xs",children:["Email: ",f.owner_email]}),t.jsxs("p",{className:"text-sm",children:["Created At: ",le(f.document_created_at).format("DD/MM/YYYY - HH:mm")," (",le().to(le(f.document_created_at)),")"]})]})]}),ue==1&&t.jsx("div",{className:"min-w-full bg-red-800 text-white p-2",children:"Rejected Doument"}),t.jsxs("div",{className:`${h?"":"templete-main-div-signer"} `,children:[t.jsxs("div",{className:"templete-app text-xs",children:[t.jsxs("div",{className:"flex gap-3 mb-2",children:[t.jsx("button",{className:"bg-[#283C42] text-white px-4 py-2 min-w-[5rem] max-w-[5rem] rounded border-2 border-transparent hover:border-[#283C42] hover:bg-white hover:text-[#283C42] transition-colors duration-300",onClick:qe,disabled:j===0,children:"Previous"}),t.jsxs("h1",{className:"mt-2",children:[j+1," / ",P.length]}),t.jsx("button",{className:"bg-[#283C42] text-white px-4 py-2 rounded border-2 min-w-[5rem] max-w-[5rem] border-transparent hover:border-[#283C42] hover:bg-white hover:text-[#283C42] transition-colors duration-300",onClick:ze,disabled:j===P.length-1,children:"Next"}),Q==1&&ue==0&&t.jsx(t.Fragment,{children:t.jsx("button",{className:"bg-[#283C42] text-white px-4 py-2 rounded border-2  border-transparent hover:border-[#283C42] hover:bg-white hover:text-[#283C42] transition-colors duration-300",onClick:He,children:"Print"})}),h&&Q==0&&t.jsx("button",{className:"bg-[#283C42] text-white px-4 py-2 cursor-not-allowed rounded border-2  border-transparent transition-colors duration-300",disabled:j===P.length-1,children:t.jsx("svg",{"data-name":"Layer 1",viewBox:"0 0 24 24",fill:"currentColor",height:"1.7em",width:"1.7em",children:t.jsx("path",{d:"M7 10a1 1 0 101 1 1 1 0 00-1-1zM3.71 2.29a1 1 0 00-1.42 1.42L4.62 6A3 3 0 002 9v6a3 3 0 003 3h1v3a1 1 0 001 1h10a1 1 0 001-1v-1.59l2.29 2.3a1 1 0 001.42 0 1 1 0 000-1.42zM6 15v1H5a1 1 0 01-1-1V9a1 1 0 011-1h1.59l6 6H7a1 1 0 00-1 1zm10 5H8v-4h6.59L16 17.41zm3-14h-1V3a1 1 0 00-1-1H8.66a1 1 0 000 2H16v2h-3.34a1 1 0 000 2H19a1 1 0 011 1v6a.37.37 0 010 .11 1 1 0 00.78 1.18h.2a1 1 0 001-.8A2.84 2.84 0 0022 15V9a3 3 0 00-3-3z"})})})]}),t.jsxs("div",{className:"workspace",ref:m,onClick:tt,children:[t.jsx(Dt,{pdfData:P[j].data}),n.filter(e=>e.pageNo===j).map(e=>{var s,a,r,i;return t.jsxs("div",{"data-id":e.id,className:` ${e.type} ${l===e.id?"selected":""}`,style:{position:"absolute",top:e.position.top,left:e.position.left,width:(a=(s=e.size)==null?void 0:s.width)!=null?a:0,height:(i=(r=e.size)==null?void 0:r.height)!=null?i:0,border:l===e.id?"1px solid red":"none",fontSize:`${e.fontSize}px`,userSelect:"none",overflow:"hidden"},onClick:d=>{d.stopPropagation(),x(e.id)},children:[e.type==="text"&&t.jsx("div",{style:{width:"100%",height:"100%",overflow:"hidden",fontSize:"inherit",outline:"none"},children:e.value||"Text Here"}),e.type==="image"&&!e.content&&t.jsx("div",{}),e.type==="v_image"&&!e.content&&t.jsx("div",{}),(e.type==="image"||e.type==="v_image"||e.type==="signature"||e.type==="v_signature")&&e.content&&t.jsx("img",{src:e.content,alt:"Uploaded",style:{width:"100%",height:"100%"}}),e.type==="checkbox"&&t.jsx("input",{type:"checkbox",checked:e.checked||!1,readOnly:!0}),e.type==="m_date"&&t.jsx("input",{type:"date",value:e.content||"",readOnly:!0}),e.type==="live_date"&&t.jsx("input",{type:"date",value:new Date().toISOString().split("T")[0],readOnly:!0}),e.type==="fix_date"&&t.jsx("input",{type:"date",value:e.content||"",readOnly:!0}),e.type==="v_text"&&t.jsx("div",{children:e.content||"Editable Text"})]},e.id)}),t.jsx(_t,{ref:re,bounds:{left:0,top:0,right:((be=m.current)==null?void 0:be.offsetWidth)||0,bottom:((ye=m.current)==null?void 0:ye.offsetHeight)||0}})]})]}),t.jsxs("div",{className:`right-div-signer p-5 cursor-pointer ${h?"hidden":""}`,children:[t.jsxs("div",{className:"w-full max-w-4xl bg-white rounded-lg shadow-md overflow-hidden ",children:[t.jsx("button",{onClick:Ve,className:"bg-[#283C42] text-white px-4 py-2 mb-4  border-transparent hover:border-[#283C42] hover:bg-white hover:text-[#283C42] transition-colors duration-300",children:"Submit"}),t.jsx("button",{onClick:We,className:"bg-[#c93737] text-white px-4 py-2 mb-4 border-transparent hover:border-[#283C42] hover:bg-white hover:text-[#283C42] transition-colors duration-300 rounded-tr-lg",children:"Reject"}),t.jsxs("table",{className:"w-full signer-table ",children:[t.jsx("thead",{children:t.jsxs("tr",{className:"bg-[#283C42] text-white",children:[t.jsx("th",{className:"py-3 px-4 text-left",children:"Sr."}),t.jsx("th",{className:"py-3 px-4 text-left",children:"Component"}),t.jsx("th",{className:"py-3 px-4 text-left",children:"Page No."}),t.jsx("th",{className:"py-3 px-4 text-left",children:"Input"})]})}),t.jsx("tbody",{children:n.filter(e=>{var s;return(s=e.assign)==null?void 0:s.includes(ie)}).map((e,s)=>t.jsxs("tr",{className:`${l===e.id?"selected-row bg-blue-100":""} ${s%2===0?"bg-gray-50":"bg-white"}`,onClick:()=>{x(e.id),N(e.pageNo),fe()},children:[t.jsx("td",{className:"py-2 px-4 border-b border-gray-200",children:s+1}),t.jsx("td",{className:"py-2 px-4 border-b border-gray-200",onClick:()=>{x(e.id)},children:e.name}),t.jsx("td",{className:"py-2 px-4 border-b border-gray-200",children:e.pageNo+1}),t.jsxs("td",{className:"py-2 px-4 border-b border-gray-200 max-w-[18vw]",children:[e.type==="signature"&&t.jsxs(t.Fragment,{children:[t.jsx(At,{onSelect:Qe,onClickbtn:fe}),t.jsx("button",{children:"Click"})]}),e.type==="image"&&t.jsx("input",{type:"file",accept:"image/*",onChange:a=>st(a,e.id)}),e.type==="checkbox"&&t.jsx("input",{type:"checkbox",checked:e.checked||!1,onChange:a=>Xe(a,e.id)}),(e.type==="m_date"||e.type==="fix_date")&&t.jsx("input",{type:"date",value:e.content||"",onChange:a=>Ze(a,e.id)}),e.type==="live_date"&&t.jsx("input",{type:"date",value:new Date().toISOString().split("T")[0],readOnly:!0}),e.type==="text"&&t.jsx("input",{className:"bg-[#d1e0e4] text-gray-700 focus:outline-none focus:shadow-outline border border-gray-300 rounded py-2 px-4 block w-full appearance-none",ref:S,type:"text",value:e.content||"",onClick:()=>{x(e.id),N(e.pageNo)},onChange:et,placeholder:"Edit text here"})]})]},e.id))})]})]}),t.jsx(Rt,{visible:L,name:f.name,onCancel:$e,onConfirm:Je,message:"Are you sure you want to submit this document? After That You Can't Change or Edit Document !",module:"Document Submit"}),t.jsx(Ut,{visible:ne,name:f.name,owner_name:f.owner_email,onCancel:Ge,onConfirm:Ye,message:"Are you sure you want to Reject this document? You Can't Revert The Action",module:"Document Reject"})]})]}),t.jsx(Ct,{limit:1})]}):t.jsx("div",{children:"No Doc data available"})};export{Qt as default};
